

<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="">
    
    
      
        <title>1.8. 子查询 - 数据库实用入门  documentation</title>
      
    
    
      
        
        
      
      

    
    
    
      
        
        
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
        <link rel="stylesheet" type="text/css" href="../../_static/sphinx_immaterial_theme.4b4a8c74e2ff2ab5b.min.css?v=afa97f93" />
        <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="light-green" data-md-color-accent="light-blue">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#id2" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../index.html" title="数据库实用入门  documentation" class="md-header__button md-logo" aria-label="数据库实用入门  documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>
    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            数据库实用入门  documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              1.8. 子查询
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="light-green" data-md-color-accent="light-blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="deep-orange" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/hellowac/practical_db_textbook-zh-cn/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    practical_db_textbook-zh-cn
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../front-matter/preface.html" class="md-tabs__link">
      <span class="md-ellipsis">前言</span>
    </a>
  </li>

      
        
  
  
    
  


  <li class="md-tabs__item">
    <a href="../index.html" class="md-tabs__link md-tabs__link--active">
      <span class="md-ellipsis">SQL</span>
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../PART2_DATA_MODELING/index.html" class="md-tabs__link">
      <span class="md-ellipsis">数据模型</span>
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../PART3_RELATIONAL_DATABASE_THEORY/index.html" class="md-tabs__link">
      <span class="md-ellipsis">关系数据库理论</span>
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../references/references.html" class="md-tabs__link">
      <span class="md-ellipsis">引用</span>
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../appendix-a-datasets/datasets.html" class="md-tabs__link">
      <span class="md-ellipsis">Appendix A:<wbr> 本书使用的示例数据集</span>
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../appendix-b-reference/reference.html" class="md-tabs__link">
      <span class="md-ellipsis">Appendix B:<wbr> SQL 参考</span>
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../front-matter/acknowledgments.html" class="md-tabs__link">
      <span class="md-ellipsis">致谢</span>
    </a>
  </li>

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../index.html" title="数据库实用入门  documentation" class="md-nav__button md-logo" aria-label="数据库实用入门  documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>
    </a>
    数据库实用入门  documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/hellowac/practical_db_textbook-zh-cn/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    practical_db_textbook-zh-cn
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../../front-matter/preface.html" class="md-nav__link">
        <span class="md-ellipsis">前言</span>
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../index.html"><span class="md-ellipsis">SQL</span></a>
          
            <label for="__nav_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="SQL" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          <span class="md-ellipsis">SQL</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../01-sql-basics/sql-basics.html" class="md-nav__link">
        <span class="md-ellipsis">基础</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../02-data-retrieval/data-retrieval.html" class="md-nav__link">
        <span class="md-ellipsis">数据检索</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../03-expressions/expressions.html" class="md-nav__link">
        <span class="md-ellipsis">表达式</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../04-multiple-tables/multiple-tables.html" class="md-nav__link">
        <span class="md-ellipsis">多个表上的查询</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../05-data-modification/data-modification.html" class="md-nav__link">
        <span class="md-ellipsis">修改数据</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../06-table-creation/table-creation.html" class="md-nav__link">
        <span class="md-ellipsis">数据类型和创建表</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../07-constraints/constraints.html" class="md-nav__link">
        <span class="md-ellipsis">键和约束</span>
      </a>
    </li>
  

            
          
            
              
  
  
    
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          <span class="md-ellipsis">子查询</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="#" class="md-nav__link md-nav__link--active">
        <span class="md-ellipsis">子查询</span>
      </a>
      
        

  

<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      <span class="md-ellipsis">子查询</span>
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#id2" class="md-nav__link">
    <span class="md-ellipsis">本章中使用的表</span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#index-1" class="md-nav__link">
    <span class="md-ellipsis">标量、行和表</span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#index-2" class="md-nav__link">
    <span class="md-ellipsis">使用子查询的布尔表达式</span>
  </a>
  
    <nav class="md-nav" aria-label="使用子查询的布尔表达式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#id5" class="md-nav__link">
    <span class="md-ellipsis">标量或行结果</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#id6" class="md-nav__link">
    <span class="md-ellipsis">表或列结果</span>
  </a>
  
    <nav class="md-nav" aria-label="表或列结果">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#in" class="md-nav__link">
    <span class="md-ellipsis">IN</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#allany-some" class="md-nav__link">
    <span class="md-ellipsis">ALL、ANY 和 SOME</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#index-5" class="md-nav__link">
    <span class="md-ellipsis">在语句中使用</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#index-6" class="md-nav__link">
    <span class="md-ellipsis">相关子查询</span>
  </a>
  
    <nav class="md-nav" aria-label="相关子查询">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exists" class="md-nav__link">
    <span class="md-ellipsis">EXISTS</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#id9" class="md-nav__link">
    <span class="md-ellipsis">其他子句中的子查询</span>
  </a>
  
    <nav class="md-nav" aria-label="其他子句中的子查询">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#select" class="md-nav__link">
    <span class="md-ellipsis">SELECT</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set" class="md-nav__link">
    <span class="md-ellipsis">SET</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from" class="md-nav__link">
    <span class="md-ellipsis">FROM</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#index-11" class="md-nav__link">
    <span class="md-ellipsis">与连接的比较</span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#id13" class="md-nav__link">
    <span class="md-ellipsis">自检练习</span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../09-grouping-and-aggregation/grouping-and-aggregation.html" class="md-nav__link">
        <span class="md-ellipsis">分组和聚合</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../10-set-operations/set-operations.html" class="md-nav__link">
        <span class="md-ellipsis">集合运算</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../11-advanced-topics/advanced-topics.html" class="md-nav__link">
        <span class="md-ellipsis">高级主题</span>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../../PART2_DATA_MODELING/index.html" class="md-nav__link">
        <span class="md-ellipsis">数据模型</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../../PART3_RELATIONAL_DATABASE_THEORY/index.html" class="md-nav__link">
        <span class="md-ellipsis">关系数据库理论</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../../references/references.html" class="md-nav__link">
        <span class="md-ellipsis">引用</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../../appendix-a-datasets/datasets.html" class="md-nav__link">
        <span class="md-ellipsis">Appendix A:<wbr> 本书使用的示例数据集</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../../appendix-b-reference/reference.html" class="md-nav__link">
        <span class="md-ellipsis">Appendix B:<wbr> SQL 参考</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../../front-matter/acknowledgments.html" class="md-nav__link">
        <span class="md-ellipsis">致谢</span>
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  

<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      <span class="md-ellipsis">子查询</span>
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#id2" class="md-nav__link">
    <span class="md-ellipsis">本章中使用的表</span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#index-1" class="md-nav__link">
    <span class="md-ellipsis">标量、行和表</span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#index-2" class="md-nav__link">
    <span class="md-ellipsis">使用子查询的布尔表达式</span>
  </a>
  
    <nav class="md-nav" aria-label="使用子查询的布尔表达式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#id5" class="md-nav__link">
    <span class="md-ellipsis">标量或行结果</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#id6" class="md-nav__link">
    <span class="md-ellipsis">表或列结果</span>
  </a>
  
    <nav class="md-nav" aria-label="表或列结果">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#in" class="md-nav__link">
    <span class="md-ellipsis">IN</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#allany-some" class="md-nav__link">
    <span class="md-ellipsis">ALL、ANY 和 SOME</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#index-5" class="md-nav__link">
    <span class="md-ellipsis">在语句中使用</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#index-6" class="md-nav__link">
    <span class="md-ellipsis">相关子查询</span>
  </a>
  
    <nav class="md-nav" aria-label="相关子查询">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exists" class="md-nav__link">
    <span class="md-ellipsis">EXISTS</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#id9" class="md-nav__link">
    <span class="md-ellipsis">其他子句中的子查询</span>
  </a>
  
    <nav class="md-nav" aria-label="其他子句中的子查询">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#select" class="md-nav__link">
    <span class="md-ellipsis">SELECT</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set" class="md-nav__link">
    <span class="md-ellipsis">SET</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from" class="md-nav__link">
    <span class="md-ellipsis">FROM</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#index-11" class="md-nav__link">
    <span class="md-ellipsis">与连接的比较</span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#id13" class="md-nav__link">
    <span class="md-ellipsis">自检练习</span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset" role="main">
                  


  <a href="https://github.com/hellowac/practical_db_textbook-zh-cn/blob/main/docs/PART1_SQL/08-subqueries/subqueries.rst" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
  </a>

<h1 id="subqueries-chapter"><span id="id1"></span><span class="section-number">1.8. </span>子查询<a class="headerlink" href="#subqueries-chapter" title="Link to this heading">¶</a></h1>
<p><strong>Subqueries</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2" id="index-0">
<input checked type="radio" id="__tabbed_1_1" name="__tabbed_1"><input type="radio" id="__tabbed_1_2" name="__tabbed_1"><div class="tabbed-labels docutils">
<label class="tabbed-label" for="__tabbed_1_1">
中文</label><label class="tabbed-label" for="__tabbed_1_2">
英文</label></div>
<div class="tabbed-content docutils">
<div class="tabbed-block docutils">
<p>子查询只是一个用括号括起来并嵌套在另一个查询或语句中的 <strong>SELECT</strong> 查询。这个 <em>子查询表达式</em> 根据查询结果和子查询出现的上下文,可以评估为标量、行、列或表。在本章中,我们将讨论在另一个查询中使用查询结果的多种方式。</p>
</div>
<div class="tabbed-block docutils">
<p>A subquery is simply a <strong>SELECT</strong> query enclosed with parentheses and nested within another query or statement.  This <em>subquery expression</em> evaluates to a scalar, a row, a column, or a table, depending on the query results and the context in which the subquery appears.  In this chapter we discuss the many ways in which we can use the result of a query within another query.</p>
</div>
</div>
</div><h2 id="id2"><span class="section-number">1.8.1. </span>本章中使用的表<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h2>
<p><strong>Tables used in this chapter</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2">
<input checked type="radio" id="__tabbed_2_1" name="__tabbed_2"><input type="radio" id="__tabbed_2_2" name="__tabbed_2"><div class="tabbed-labels docutils">
<label class="tabbed-label" for="__tabbed_2_1">
中文</label><label class="tabbed-label" for="__tabbed_2_2">
英文</label></div>
<div class="tabbed-content docutils">
<div class="tabbed-block docutils">
<p>在本章中,我们将使用书籍数据集(表 <strong>books</strong>、<strong>authors</strong> 等),该数据集在 <a class="reference internal" href="../../appendix-a-datasets/datasets.html#appendix-a"><span class="std std-ref">附录 A</span></a> 中进行了描述。</p>
</div>
<div class="tabbed-block docutils">
<p>For this chapter we will be using the books dataset (tables <strong>books</strong>, <strong>authors</strong>, etc.), described in <a class="reference internal" href="../../appendix-a-datasets/datasets.html#appendix-a"><span class="std std-ref">Appendix A</span></a>.</p>
</div>
</div>
</div><h2 id="index-1"><span id="id3"></span><span class="section-number">1.8.2. </span>标量、行和表<a class="headerlink" href="#index-1" title="Link to this heading">¶</a></h2>
<p><strong>Scalars, rows, and tables</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2">
<input checked type="radio" id="__tabbed_3_1" name="__tabbed_3"><input type="radio" id="__tabbed_3_2" name="__tabbed_3"><div class="tabbed-labels docutils">
<label class="tabbed-label" for="__tabbed_3_1">
中文</label><label class="tabbed-label" for="__tabbed_3_2">
英文</label></div>
<div class="tabbed-content docutils">
<div class="tabbed-block docutils">
<p>在讨论子查询的用法之前,讨论一些在 SQL 中出现的额外数据类型是有用的。到目前为止,我们假设所有表达式都计算为 <em>标量</em> 值。标量值是单一类型的简单值,例如 <code class="docutils literal notranslate"><span class="pre">42</span></code> 或 <code class="docutils literal notranslate"><span class="pre">'hello'</span></code> 。我们还可以在 SQL 中处理 <em>行</em> 值。行只是一个有序的值列表。我们可以通过将用逗号分隔的表达式列表放在括号之间来写出一个文字行(SQL 称这些为“行值构造器”)：</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;hello&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">.</span><span class="mi">1415</span><span class="p">)</span>
</code></pre></div>
</div>
<p>在大多数数据库中(但不包括 SQLite),您可以将上述表达式作为文字进行 <strong>SELECT</strong>,结果将显示为单列。</p>
<p>行可以用于比较表达式。以下两个查询是等效的(尽管第二个查询可能因为风格问题更受欢迎)：</p>
<p>download: <a class="reference external" href="/_static/textbook.sqlite3">sqlite3 file</a></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="n">subqueries_example_row_expressions</span>

<span class="k">SELECT</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">title</span>
<span class="k">FROM</span>
<span class="w">  </span><span class="n">books</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b</span>
<span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="n">authors</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">author_id</span>
<span class="k">WHERE</span>
<span class="w">  </span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">publication_year</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;V. S. Naipaul&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1961</span><span class="p">);</span>

<span class="k">SELECT</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">title</span>
<span class="k">FROM</span>
<span class="w">  </span><span class="n">books</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b</span>
<span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="n">authors</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">author_id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;V. S. Naipaul&#39;</span>
<span class="k">AND</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">publication_year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1961</span><span class="p">;</span>
</code></pre></div>
</div>
<p>我们将在以下部分看到行表达式的更多有用应用。</p>
<p>超出行的范围,我们还可以将 <em>表</em> 视为值。在这里,我们使用“表”来表示一组行,而不一定是数据库中存在的命名对象。从 <strong>SELECT</strong> 查询得到的结果在这个意义上是一个表。</p>
</div>
<div class="tabbed-block docutils">
<p>Before we discuss the uses of subqueries, it is useful to talk about some additional types of data that come up in SQL.  So far we have assumed that all expressions evaluate to a <em>scalar</em> value.  Scalar values are simple values of a single type, such as <code class="docutils literal notranslate"><span class="pre">42</span></code> or <code class="docutils literal notranslate"><span class="pre">'hello'</span></code>.  We can also work with <em>row</em> values in SQL.  A row is just an ordered list of values.  We can write down a literal row (SQL calls these “row value constructors”) by putting a comma-separated list of expressions between parentheses:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;hello&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">.</span><span class="mi">1415</span><span class="p">)</span>
</code></pre></div>
</div>
<p>In most databases (but not SQLite), you can <strong>SELECT</strong> the above expression as a literal, with the result showing as a single column.</p>
<p>Rows can be used in comparison expressions. The two queries below are equivalent (although the second is probably preferred as a matter of style):</p>
<p>download: <a class="reference external" href="/_static/textbook.sqlite3">sqlite3 file</a></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="n">subqueries_example_row_expressions</span>

<span class="k">SELECT</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">title</span>
<span class="k">FROM</span>
<span class="w">  </span><span class="n">books</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b</span>
<span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="n">authors</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">author_id</span>
<span class="k">WHERE</span>
<span class="w">  </span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">publication_year</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;V. S. Naipaul&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1961</span><span class="p">);</span>

<span class="k">SELECT</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">title</span>
<span class="k">FROM</span>
<span class="w">  </span><span class="n">books</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b</span>
<span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="n">authors</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">author_id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;V. S. Naipaul&#39;</span>
<span class="k">AND</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">publication_year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1961</span><span class="p">;</span>
</code></pre></div>
</div>
<p>We will see more useful applications of row expressions in the following sections.</p>
<p>Beyond rows, we can also think in terms of <em>tables</em> as values.  Here we are using “tables” to mean a collection of rows, not necessarily the named object living in the database.  The result from a <strong>SELECT</strong> query is a table in this sense.</p>
</div>
</div>
</div><h2 id="index-2"><span id="id4"></span><span class="section-number">1.8.3. </span>使用子查询的布尔表达式<a class="headerlink" href="#index-2" title="Link to this heading">¶</a></h2>
<p><strong>Boolean expressions using subqueries</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:2">
<input checked type="radio" id="__tabbed_4_1" name="__tabbed_4"><input type="radio" id="__tabbed_4_2" name="__tabbed_4"><div class="tabbed-labels docutils">
<label class="tabbed-label" for="__tabbed_4_1">
中文</label><label class="tabbed-label" for="__tabbed_4_2">
英文</label></div>
<div class="tabbed-content docutils">
<div class="tabbed-block docutils">
<p>首先,我们将使用子查询来检查布尔表达式。这些表达式适合在另一个查询或语句的 <strong>WHERE</strong> 子句中使用。</p>
</div>
<div class="tabbed-block docutils">
<p>To start with, we will examine Boolean expressions using subqueries.  These are appropriate for use within the <strong>WHERE</strong> clause of another query or statement.</p>
</div>
</div>
</div><h3 id="id5"><span class="section-number">1.8.3.1. </span>标量或行结果<a class="headerlink" href="#id5" title="Link to this heading">¶</a></h3>
<p><strong>Scalar or row result</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="5:2">
<input checked type="radio" id="__tabbed_5_1" name="__tabbed_5"><input type="radio" id="__tabbed_5_2" name="__tabbed_5"><div class="tabbed-labels docutils">
<label class="tabbed-label" for="__tabbed_5_1">
中文</label><label class="tabbed-label" for="__tabbed_5_2">
英文</label></div>
<div class="tabbed-content docutils">
<div class="tabbed-block docutils">
<p>我们可以用子查询代替标量表达式,只要我们知道子查询将返回单行单列。让我们回到 <a class="reference internal" href="../04-multiple-tables/multiple-tables.html#joins-chapter"><span class="std std-numref">Chapter 1.4</span></a> 中的一个示例,使用我们的 <strong>books</strong> 表：我们如何找到与《三体》同年出版的所有书籍？我们将使用子查询(下面括号中的 <strong>SELECT</strong> 查询)首先获取《三体》的 <strong>publication_year</strong>,然后使用该结果获取我们的书籍列表：</p>
<p>download: <a class="reference external" href="/_static/textbook.sqlite3">sqlite3 file</a></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="n">subqueries_example_single_row</span>

<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">publication_year</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">publication_year</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span>
<span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;The Three-Body Problem&#39;</span><span class="p">)</span>
<span class="p">;</span>
</code></pre></div>
</div>
<p>要查看此查询的工作原理,首先单独执行子查询：</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">publication_year</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">books</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;The Three-Body Problem&#39;</span><span class="p">;</span>
</code></pre></div>
</div>
<p>由于这个特定的查询返回正好一行一列,我们将结果(整数 <code class="docutils literal notranslate"><span class="pre">2008</span></code>)视为标量值,并简单地将标量替换为子查询：</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">publication_year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2008</span><span class="p">;</span>
</code></pre></div>
</div>
<p>请注意,这只有在我们只有一本书名为《三体》的情况下才有效。一般来说,除非您在已知保存唯一值的列上使用 <strong>WHERE</strong> 子句条件,或者您正在对一组行计算聚合统计(我们将在 <a class="reference internal" href="../09-grouping-and-aggregation/grouping-and-aggregation.html#grouping-chapter"><span class="std std-numref">Chapter 1.9</span></a> 中讨论聚合),否则假设查询将返回单行并不是一个好主意。如果子查询返回多行,查询将导致错误。然而,如果子查询返回零行,则结果被视为 <code class="docutils literal notranslate"><span class="pre">NULL</span></code>,而不是错误。</p>
<p>这种方法同样适用于行表达式,尽管语法可能有些不一致。如果子查询返回多列,那么您只需要在比较的左侧使用行表达式。也就是说,以下 SQL 是正确的：</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span>
<span class="k">WHERE</span><span class="w"> </span><span class="p">(</span><span class="n">author_id</span><span class="p">,</span><span class="w"> </span><span class="n">publication_year</span><span class="p">)</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">author_id</span><span class="p">,</span><span class="w"> </span><span class="n">publication_year</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span>
<span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;The Hundred Thousand Kingdoms&#39;</span><span class="p">)</span>
<span class="p">;</span>
</code></pre></div>
</div>
<p>在子查询的 <strong>SELECT</strong> 子句中将列用括号括起来会导致错误。</p>
<p>与标量结果的比较不必是等于;您可以使用任何比较运算符：</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">publication_year</span><span class="w"> </span><span class="o">&gt;</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">publication_year</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span>
<span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Americanah&#39;</span><span class="p">)</span>
<span class="p">;</span>
</code></pre></div>
</div>
</div>
<div class="tabbed-block docutils">
<p>We can use a subquery in place of a scalar expression as long as we know the subquery will return a single row and column.  Let us return to an example from <a class="reference internal" href="../04-multiple-tables/multiple-tables.html#joins-chapter"><span class="std std-numref">Chapter 1.4</span></a> using our <strong>books</strong> table: how can we find all books published in the same year as <em>The Three-Body Problem</em>?  We will use a subquery (the <strong>SELECT</strong> query inside the parentheses below) to first obtain the <strong>publication_year</strong> of <em>The Three-Body Problem</em>, and then we will use that result to get our list of books:</p>
<p>download: <a class="reference external" href="/_static/textbook.sqlite3">sqlite3 file</a></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="n">subqueries_example_single_row</span>

<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">publication_year</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">publication_year</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span>
<span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;The Three-Body Problem&#39;</span><span class="p">)</span>
<span class="p">;</span>
</code></pre></div>
</div>
<p>To see what is happening in this query, first execute the subquery on its own:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">publication_year</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">books</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;The Three-Body Problem&#39;</span><span class="p">;</span>
</code></pre></div>
</div>
<p>Since this particular query returns exactly one row and one column, we treat the result (the integer <code class="docutils literal notranslate"><span class="pre">2008</span></code>) as a scalar value, and simply substitute the scalar in place of the subquery:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">publication_year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2008</span><span class="p">;</span>
</code></pre></div>
</div>
<p>Note that this only works because we only have one book with the title <em>The Three-Body Problem</em>.  In general, it is not a good idea to assume a query will return a single row unless you use a <strong>WHERE</strong> clause condition on a column known to hold unique values, or unless you are computing an aggregate statistic over a set of rows (we will discuss aggregates in <a class="reference internal" href="../09-grouping-and-aggregation/grouping-and-aggregation.html#grouping-chapter"><span class="std std-numref">Chapter 1.9</span></a>).  If multiple rows are returned by the subquery, the query will result in an error.  However, if zero rows are returned from the subquery, the result is considered to be <code class="docutils literal notranslate"><span class="pre">NULL</span></code>, rather than an error.</p>
<p>This same approach works with row expressions, although the syntax is perhaps a bit inconsistent.  If a subquery would return multiple columns, then you need to use a row expression on the left-hand side of your comparison only.  That is, the below is correct SQL:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span>
<span class="k">WHERE</span><span class="w"> </span><span class="p">(</span><span class="n">author_id</span><span class="p">,</span><span class="w"> </span><span class="n">publication_year</span><span class="p">)</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">author_id</span><span class="p">,</span><span class="w"> </span><span class="n">publication_year</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span>
<span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;The Hundred Thousand Kingdoms&#39;</span><span class="p">)</span>
<span class="p">;</span>
</code></pre></div>
</div>
<p>Putting parentheses around the columns in the <strong>SELECT</strong> clause of the subquery will cause an error.</p>
<p>Comparisons with scalar results do not have to be equality; you can use any comparison operator instead:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">publication_year</span><span class="w"> </span><span class="o">&gt;</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">publication_year</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span>
<span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Americanah&#39;</span><span class="p">)</span>
<span class="p">;</span>
</code></pre></div>
</div>
</div>
</div>
</div><h3 id="id6"><span class="section-number">1.8.3.2. </span>表或列结果<a class="headerlink" href="#id6" title="Link to this heading">¶</a></h3>
<p><strong>Table or column result</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="6:2">
<input checked type="radio" id="__tabbed_6_1" name="__tabbed_6"><input type="radio" id="__tabbed_6_2" name="__tabbed_6"><div class="tabbed-labels docutils">
<label class="tabbed-label" for="__tabbed_6_1">
中文</label><label class="tabbed-label" for="__tabbed_6_2">
英文</label></div>
<div class="tabbed-content docutils">
<div class="tabbed-block docutils">
<p>当查询可以返回多行(列或表)时,我们有一组不同的运算符可供使用。在本节中,我们讨论 <strong>IN</strong> 运算符以及与 <strong>ALL</strong>、<strong>ANY</strong> 和 <strong>SOME</strong> 一起使用的比较运算符。另一个布尔运算符 <strong>EXISTS</strong> 将在我们稍后讨论相关子查询时再进行讨论。所有可以处理多行的运算符也适用于返回零行或一行的子查询。</p>
</div>
<div class="tabbed-block docutils">
<p>When a query can return multiple rows (a column or table), we have a different set of operators to work with.  In this section, we discuss the <strong>IN</strong> operator and the use of comparison operators with <strong>ALL</strong>, <strong>ANY</strong>, and <strong>SOME</strong>.  Another Boolean operator, <strong>EXISTS</strong>, will wait until we discuss correlated subqueries later in the chapter.  All of the operators that work with multiple rows also work on subqueries which return zero rows or one row.</p>
</div>
</div>
</div><h4 id="in"><span id="index-3"></span><span class="section-number">1.8.3.2.1. </span>IN<a class="headerlink" href="#in" title="Link to this heading">¶</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="7:2">
<input checked type="radio" id="__tabbed_7_1" name="__tabbed_7"><input type="radio" id="__tabbed_7_2" name="__tabbed_7"><div class="tabbed-labels docutils">
<label class="tabbed-label" for="__tabbed_7_1">
中文</label><label class="tabbed-label" for="__tabbed_7_2">
英文</label></div>
<div class="tabbed-content docutils">
<div class="tabbed-block docutils">
<p><strong>IN</strong> 运算符允许我们将某个表达式与子查询返回的每一行进行比较。如果该表达式等于子查询中的任何结果,则 <strong>IN</strong> 表达式的值为 <code class="docutils literal notranslate"><span class="pre">True</span></code>。例如,我们可以向数据库请求获奖书籍的列表(书籍 ID 匹配 <strong>books_awards</strong> 表中的某个书籍 ID)：</p>
<p>download: <a class="reference external" href="/_static/textbook.sqlite3">sqlite3 file</a></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="n">subqueries_example_multiple_rows</span>

<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">book_id</span><span class="w"> </span><span class="k">IN</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">book_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books_awards</span><span class="p">)</span>
<span class="p">;</span>
</code></pre></div>
</div>
<p>SQL 还提供 <strong>NOT IN</strong> 运算符,它只是 <strong>IN</strong> 的布尔逆运算符。通过简单修改上述查询,我们可以获得未获得数据库中列出的任何奖项的书籍列表：</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">book_id</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">book_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books_awards</span><span class="p">)</span>
<span class="p">;</span>
</code></pre></div>
</div>
<p><strong>IN</strong> 运算符同样适用于行表达式,当我们想要与多个列的子查询结果进行比较时。下面是一个查询,询问与作者去世年份相同的书籍。(我们使用 SQLite 实现的 <strong>substring</strong> 函数,仅提取每位作者去世日期的前四个字符。尽管子字符串是字符型,而书籍出版年份存储为整数,SQLite 能够进行适当的类型转换以进行比较。)</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">author</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">publication_year</span>
<span class="k">FROM</span>
<span class="w">  </span><span class="n">authors</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a</span>
<span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">author_id</span>
<span class="k">WHERE</span>
<span class="w">  </span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">author_id</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">publication_year</span><span class="p">)</span><span class="w"> </span><span class="k">IN</span>
<span class="w">    </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">author_id</span><span class="p">,</span><span class="w"> </span><span class="k">substring</span><span class="p">(</span><span class="n">death</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">authors</span><span class="p">)</span>
<span class="p">;</span>
</code></pre></div>
</div>
<p>和往常一样,单独执行子查询以查看它返回的值,可以帮助我们更好地理解整个查询的作用。</p>
<p><strong>IN</strong> 还有一个不涉及子查询的有用应用。如果我们在 <strong>IN</strong> 后面跟一个用逗号分隔的表达式列表(用括号括起来),该运算符将对 <strong>IN</strong> 左侧的表达式与括号内列出的每个表达式进行测试。注意,虽然表达式列表看起来像行表达式,但它是非常不同的; <strong>IN</strong> 后列表中的每个表达式都应该与正在比较的表达式具有兼容的类型。</p>
<p>例如,我们可能对几位不同作者的书籍感兴趣：</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">author</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">title</span>
<span class="k">FROM</span>
<span class="w">  </span><span class="n">books</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b</span>
<span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="n">authors</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">author_id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">author</span><span class="w"> </span><span class="k">IN</span>
<span class="w">  </span><span class="p">(</span><span class="s1">&#39;Virginia Woolf&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Kazuo Ishiguro&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Iris Murdoch&#39;</span><span class="p">);</span>
</code></pre></div>
</div>
<p>如果我们想比较多个值(即行表达式),必须为每个表达式使用括号。在这种情况下,表达式的一般形式是：</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="p">(</span><span class="n">expr1</span><span class="p">,</span><span class="w"> </span><span class="n">expr2</span><span class="p">,</span><span class="w"> </span><span class="p">...)</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">((</span><span class="n">test11</span><span class="p">,</span><span class="w"> </span><span class="n">test12</span><span class="p">,</span><span class="w"> </span><span class="p">...),</span><span class="w"> </span><span class="p">(</span><span class="n">test21</span><span class="p">,</span><span class="w"> </span><span class="n">test22</span><span class="p">,</span><span class="w"> </span><span class="p">...),</span><span class="w"> </span><span class="p">...)</span>
</code></pre></div>
</div>
</div>
<div class="tabbed-block docutils">
<p>The <strong>IN</strong> operator lets us compare some expression to every row returned from a subquery.  If the expression equals any result from the subquery, then the <strong>IN</strong> expression evaluates to <code class="docutils literal notranslate"><span class="pre">True</span></code>.  For example, we can ask our database for a list of books which have won awards (books with book ids matching some book id in the <strong>books_awards</strong> table):</p>
<p>download: <a class="reference external" href="/_static/textbook.sqlite3">sqlite3 file</a></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="n">subqueries_example_multiple_rows</span>

<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">book_id</span><span class="w"> </span><span class="k">IN</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">book_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books_awards</span><span class="p">)</span>
<span class="p">;</span>
</code></pre></div>
</div>
<p>SQL also provides the <strong>NOT IN</strong> operator as simply the Boolean inverse of <strong>IN</strong>.  We can get a list of books that did not win any of the awards listed in our database by a simple modification of the above query:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">book_id</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">book_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books_awards</span><span class="p">)</span>
<span class="p">;</span>
</code></pre></div>
</div>
<p>The <strong>IN</strong> operator also works with row expressions, when we want to compare against multiple column subquery results.  Here is a query that asks for books published in the same year as the author’s death.  (We are using the <strong>substring</strong> function as implemented by SQLite to get just the first four characters of each author’s death date.  Although the substring is a character string and book publication years are stored as integers, SQLite is able to do an appropriate type conversion to make the comparison.)</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">author</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">publication_year</span>
<span class="k">FROM</span>
<span class="w">  </span><span class="n">authors</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a</span>
<span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">author_id</span>
<span class="k">WHERE</span>
<span class="w">  </span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">author_id</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">publication_year</span><span class="p">)</span><span class="w"> </span><span class="k">IN</span>
<span class="w">    </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">author_id</span><span class="p">,</span><span class="w"> </span><span class="k">substring</span><span class="p">(</span><span class="n">death</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">authors</span><span class="p">)</span>
<span class="p">;</span>
</code></pre></div>
</div>
<p>As always, it can be helpful to execute the subquery separately to see what values it returns in order to better understand what the entire query is doing.</p>
<p><strong>IN</strong> also has a useful application that does not involve a subquery.  If we follow <strong>IN</strong> with a comma-separated list of expressions inside parentheses, the operator will test the expression to the left of <strong>IN</strong> against every expression listed in the parentheses. Note that while the expression list looks like a row expression, it is very different; every expression in the list after <strong>IN</strong> should have a type compatible with the expression being compared.</p>
<p>For example, we might be interested in books by a few different authors:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">author</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">title</span>
<span class="k">FROM</span>
<span class="w">  </span><span class="n">books</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b</span>
<span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="n">authors</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">author_id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">author</span><span class="w"> </span><span class="k">IN</span>
<span class="w">  </span><span class="p">(</span><span class="s1">&#39;Virginia Woolf&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Kazuo Ishiguro&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Iris Murdoch&#39;</span><span class="p">);</span>
</code></pre></div>
</div>
<p>If we want to compare multiple values (i.e., row expressions), we must use parentheses for each expression.  In this case, the general form of the expression is</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="p">(</span><span class="n">expr1</span><span class="p">,</span><span class="w"> </span><span class="n">expr2</span><span class="p">,</span><span class="w"> </span><span class="p">...)</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">((</span><span class="n">test11</span><span class="p">,</span><span class="w"> </span><span class="n">test12</span><span class="p">,</span><span class="w"> </span><span class="p">...),</span><span class="w"> </span><span class="p">(</span><span class="n">test21</span><span class="p">,</span><span class="w"> </span><span class="n">test22</span><span class="p">,</span><span class="w"> </span><span class="p">...),</span><span class="w"> </span><span class="p">...)</span>
</code></pre></div>
</div>
</div>
</div>
</div><h4 id="allany-some"><span id="index-4"></span><span class="section-number">1.8.3.2.2. </span>ALL、ANY 和 SOME<a class="headerlink" href="#allany-some" title="Link to this heading">¶</a></h4>
<p><strong>ALL, ANY, and SOME</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="8:2">
<input checked type="radio" id="__tabbed_8_1" name="__tabbed_8"><input type="radio" id="__tabbed_8_2" name="__tabbed_8"><div class="tabbed-labels docutils">
<label class="tabbed-label" for="__tabbed_8_1">
中文</label><label class="tabbed-label" for="__tabbed_8_2">
英文</label></div>
<div class="tabbed-content docutils">
<div class="tabbed-block docutils">
<p>我们也可以结合使用比较运算符与 <strong>ALL</strong>、<strong>ANY</strong> 或 <strong>SOME</strong> 关键字,将某个表达式与子查询的结果进行比较。例如,我们可以再次请求获奖书籍的列表,使用等于运算符与 <strong>ANY</strong> 关键字,如下所示(注意,**ALL**/<strong>ANY</strong>/<strong>SOME</strong> 关键字在 SQLite 中不受支持,因此你不能在教科书的互动工具中测试这一点)：</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">book_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">ANY</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">book_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books_awards</span><span class="p">);</span>
</code></pre></div>
</div>
<p><strong>SOME</strong> 只是 <strong>ANY</strong> 的同义词。当 <strong>IN</strong> 运算符与子查询结合使用时,相当于 <strong>= ANY</strong>。然而,**ANY** 不能像 <strong>IN</strong> 那样与表达式列表一起使用。</p>
<p>相反,**ALL** 要求子查询返回的每一行都通过比较测试。例如,要查找所有由作者威拉·凯瑟(Willa Cather)出版的书籍之前出版的书籍：</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">publication_year</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">ALL</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">publication_year</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">authors</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Willa Cather&#39;</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span>
<span class="p">;</span>
</code></pre></div>
</div>
<p>注意,这里我们在另一个子查询内部使用了子查询！我们可以以这种方式嵌套子查询;我们还可以在复合布尔表达式中使用多个子查询。</p>
<p><strong>NOT IN</strong> 运算符相当于 <strong>&lt;&gt; ALL</strong>。</p>
</div>
<div class="tabbed-block docutils">
<p>We can alternately use comparison operators in conjunction with the <strong>ALL</strong> or <strong>ANY</strong> or <strong>SOME</strong> keywords to compare an expression against the results of a subquery.  For example, we can ask again for books which have won awards by using the equality operator together with the <strong>ANY</strong> keyword as follows (note that the <strong>ALL</strong>/<strong>ANY</strong>/<strong>SOME</strong> keywords are not supported by SQLite, so you cannot test this within the textbook’s interactive tools):</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">book_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">ANY</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">book_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books_awards</span><span class="p">);</span>
</code></pre></div>
</div>
<p><strong>SOME</strong> is just a synonym for <strong>ANY</strong>.  The <strong>IN</strong> operator when used with subqueries is equivalent to <strong>= ANY</strong>.  However, <strong>ANY</strong> cannot be used with an expression list in the same way <strong>IN</strong> can.</p>
<p>In contrast, <strong>ALL</strong> requires that every row returned the subquery passes the comparison test.  For example, to find books published before all books by the author Willa Cather:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">publication_year</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">ALL</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">publication_year</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">authors</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Willa Cather&#39;</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span>
<span class="p">;</span>
</code></pre></div>
</div>
<p>Note here we have used a subquery inside another subquery!  We can nest subqueries in this fashion; we can also use multiple subqueries within a compound Boolean expression.</p>
<p>The <strong>NOT IN</strong> operator is equivalent to <strong>&lt;&gt; ALL</strong>.</p>
</div>
</div>
</div><h3 id="index-5"><span id="id7"></span><span class="section-number">1.8.3.3. </span>在语句中使用<a class="headerlink" href="#index-5" title="Link to this heading">¶</a></h3>
<p><strong>Use in statements</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="9:2">
<input checked type="radio" id="__tabbed_9_1" name="__tabbed_9"><input type="radio" id="__tabbed_9_2" name="__tabbed_9"><div class="tabbed-labels docutils">
<label class="tabbed-label" for="__tabbed_9_1">
中文</label><label class="tabbed-label" for="__tabbed_9_2">
英文</label></div>
<div class="tabbed-content docutils">
<div class="tabbed-block docutils">
<p>子查询不仅可以用于其他 <strong>SELECT</strong> 查询中。将子查询用于 <strong>DELETE</strong> 或 <strong>UPDATE</strong> 语句的 <strong>WHERE</strong> 子句中可以非常强大,往往弥补了在这些类型的语句中无法进行连接的缺点。例如,我们可以使用子查询从数据库中删除没有书籍的作者：</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">authors</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="p">);</span>
</code></pre></div>
</div>
<p>数据库中没有符合此条件的行(除非你添加它们),因此上述查询不会删除任何行,但它成功执行。</p>
</div>
<div class="tabbed-block docutils">
<p>Subqueries do not have to be used only within other <strong>SELECT</strong> queries.  The use of subqueries within the <strong>WHERE</strong> clause of <strong>DELETE</strong> or <strong>UPDATE</strong> statements can be very powerful, often making up for the fact that we cannot do joins within those types of statements.  For example, we could use a subquery to remove any authors from our database for whom we have no books:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">authors</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="p">);</span>
</code></pre></div>
</div>
<p>There are no rows matching this condition in the database (unless you add them), so the above query does not remove any rows, although it runs successfully.</p>
</div>
</div>
</div><h2 id="index-6"><span id="id8"></span><span class="section-number">1.8.4. </span>相关子查询<a class="headerlink" href="#index-6" title="Link to this heading">¶</a></h2>
<p><strong>Correlated subqueries</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="10:2">
<input checked type="radio" id="__tabbed_10_1" name="__tabbed_10"><input type="radio" id="__tabbed_10_2" name="__tabbed_10"><div class="tabbed-labels docutils">
<label class="tabbed-label" for="__tabbed_10_1">
中文</label><label class="tabbed-label" for="__tabbed_10_2">
英文</label></div>
<div class="tabbed-content docutils">
<div class="tabbed-block docutils">
<p>到目前为止,在我们的所有示例中,我们使用的子查询都是可以独立执行的单独 <strong>SELECT</strong> 查询。子查询可以执行一次,其结果在外部查询中替代。然而,也可以构造依赖于外部查询的子查询。当子查询在表达式中引用外部查询的某个属性时,我们称该子查询与外部查询是 <em>相关的</em>。</p>
<p>例如,考虑查找在作者去世后出版的书籍(遗作)的问题。我们之前看到了一种使用子查询获取与作者去世年份相同年份出版的书籍的方法：</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">author</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">publication_year</span>
<span class="k">FROM</span>
<span class="w">  </span><span class="n">authors</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a</span>
<span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">author_id</span>
<span class="k">WHERE</span>
<span class="w">  </span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">author_id</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">publication_year</span><span class="p">)</span><span class="w"> </span><span class="k">IN</span>
<span class="w">    </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">author_id</span><span class="p">,</span><span class="w"> </span><span class="k">substring</span><span class="p">(</span><span class="n">death</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">authors</span><span class="p">)</span>
<span class="p">;</span>
</code></pre></div>
</div>
<p>目前尚不清楚我们如何修改该查询的 <strong>WHERE</strong> 子句以查找在作者去世 <em>之后</em> 出版的书籍。我们希望作者 ID 匹配(相等),但需要不同的运算符(大于)来将出版年份与作者的去世年份进行比较。我们想要做的是,对于外部查询中的每本书,将其出版年份与 <em>其作者的去世年份</em> 进行比较。为此,我们需要子查询仅返回与外部查询当前行相关的结果——在这种情况下,子查询应返回表示书籍作者去世年份的标量值。</p>
<p>以下是解决方案：</p>
<p>download: <a class="reference external" href="/_static/textbook.sqlite3">sqlite3 file</a></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="n">subqueries_example_correlated</span>

<span class="k">SELECT</span>
<span class="w">  </span><span class="n">a1</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">author</span><span class="p">,</span><span class="w"> </span><span class="n">a1</span><span class="p">.</span><span class="n">death</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">publication_year</span>
<span class="k">FROM</span>
<span class="w">  </span><span class="n">authors</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a1</span>
<span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">a1</span><span class="p">.</span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">author_id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">publication_year</span><span class="w"> </span><span class="o">&gt;</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">substring</span><span class="p">(</span><span class="n">death</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">authors</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a2</span>
<span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">a2</span><span class="p">.</span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a1</span><span class="p">.</span><span class="n">author_id</span><span class="p">)</span>
<span class="p">;</span>
</code></pre></div>
</div>
<p>注意,我们面临着需要使用别名解决歧义的情况——我们有两个 <strong>authors</strong> 表的实例,一个用于外部查询,一个用于子查询。如果我们简单地在子查询中引用 <strong>author_id</strong>,SQL 会假设我们指的是子查询的 <strong>authors</strong> 表。要引用外部查询的 <strong>authors</strong> 表,我们必须给它一个别名(<strong>a1</strong>)以区别。虽然不是必要的,但我们也选择为子查询的表(<strong>a2</strong>)起别名,以避免任何混淆的可能性。</p>
<p>正如你所看到的,我们不再能够独立于外部查询运行子查询。实际上,我们正在对外部查询中遇到的每一行重复运行子查询。</p>
<p>与此示例一样,当外部查询和子查询处理同一张表时,相关子查询往往最为有用。当外部查询和子查询处理不同的表时,通常可以将查询写成无相关的形式。</p>
</div>
<div class="tabbed-block docutils">
<p>In all of our examples so far, we used subqueries which are executable on their own as separate <strong>SELECT</strong> queries.  The subquery can be executed once, with the result of the subquery substituted in its place in the outer query.  It is possible, however, to construct subqueries that are dependent on the outer query.  When a subquery references some attribute from the outer query in an expression, we say that the subquery is <em>correlated</em> with the outer query.</p>
<p>For example, consider the problem of finding books published after the author’s death (posthumous books).  We previously saw a way of using a subquery to get books published in the same year as the author’s death:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">author</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">publication_year</span>
<span class="k">FROM</span>
<span class="w">  </span><span class="n">authors</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a</span>
<span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">author_id</span>
<span class="k">WHERE</span>
<span class="w">  </span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">author_id</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">publication_year</span><span class="p">)</span><span class="w"> </span><span class="k">IN</span>
<span class="w">    </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">author_id</span><span class="p">,</span><span class="w"> </span><span class="k">substring</span><span class="p">(</span><span class="n">death</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">authors</span><span class="p">)</span>
<span class="p">;</span>
</code></pre></div>
</div>
<p>It is not clear how we can modify this query’s <strong>WHERE</strong> clause to find books published <em>after</em> the author’s death.  We want the author ids to match (equality), but we need a different operator (greater than) to compare the publication year with the author’s death year.  What we want to do is, for each book in the outer query, compare its publication year to the death year of <em>its author only</em>.  To do this, we need our subquery to only return results relevant for the current row in the outer query - in this case, the subquery should return the scalar value representing the book’s author’s death year.</p>
<p>Here is the solution:</p>
<p>download: <a class="reference external" href="/_static/textbook.sqlite3">sqlite3 file</a></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="n">subqueries_example_correlated</span>

<span class="k">SELECT</span>
<span class="w">  </span><span class="n">a1</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">author</span><span class="p">,</span><span class="w"> </span><span class="n">a1</span><span class="p">.</span><span class="n">death</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">publication_year</span>
<span class="k">FROM</span>
<span class="w">  </span><span class="n">authors</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a1</span>
<span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">a1</span><span class="p">.</span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">author_id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">publication_year</span><span class="w"> </span><span class="o">&gt;</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">substring</span><span class="p">(</span><span class="n">death</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">authors</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a2</span>
<span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">a2</span><span class="p">.</span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a1</span><span class="p">.</span><span class="n">author_id</span><span class="p">)</span>
<span class="p">;</span>
</code></pre></div>
</div>
<p>Note that we have a situation where ambiguity must be resolved using aliasing - we have two instances of the <strong>authors</strong> table, one used in the outer query and one in the subquery.  If we simply refer to <strong>author_id</strong> in the subquery, SQL assumes we mean the subquery’s <strong>authors</strong> table.  To refer to the outer query’s <strong>authors</strong> table, we must give it an alias (<strong>a1</strong>) to distinguish it.  While not necessary, we have chosen to alias the subquery’s table (<strong>a2</strong>) as well, to avoid any chance of confusion.</p>
<p>As you can see, we can no longer run the subquery independent of the outer query.  In effect, we are running the subquery over and over again, once for each row we encounter in the outer query.</p>
<p>As in this example, correlated subqueries tend to be most useful when both the outer query and the subquery work with the same table.  When the outer query and subquery work with different tables, it is typically possible to write the query as uncorrelated.</p>
</div>
</div>
</div><h3 id="exists"><span id="index-7"></span><span class="section-number">1.8.4.1. </span>EXISTS<a class="headerlink" href="#exists" title="Link to this heading">¶</a></h3>
<p><strong>EXISTS</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="11:2">
<input checked type="radio" id="__tabbed_11_1" name="__tabbed_11"><input type="radio" id="__tabbed_11_2" name="__tabbed_11"><div class="tabbed-labels docutils">
<label class="tabbed-label" for="__tabbed_11_1">
中文</label><label class="tabbed-label" for="__tabbed_11_2">
英文</label></div>
<div class="tabbed-content docutils">
<div class="tabbed-block docutils">
<p><strong>EXISTS</strong> 运算符在子查询之前,子查询是唯一的操作数。只有当子查询返回一行或多行时,**EXISTS** 表达式才会评估为 <code class="docutils literal notranslate"><span class="pre">True</span></code>。子查询中的实际数据被忽略,因此你可以在 <strong>SELECT</strong> 子句中放入任何你想要的内容。我们在示例中将使用常量 <code class="docutils literal notranslate"><span class="pre">1</span></code>,只是为了强调我们返回的数据并不重要。</p>
<p>许多无相关子查询可以重写为使用 <strong>EXISTS</strong> 的相关子查询。例如,要查找所有获得奖项的书籍,我们可以写：</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">book_id</span><span class="w"> </span><span class="k">IN</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">book_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books_awards</span><span class="p">)</span>
<span class="p">;</span>
</code></pre></div>
</div>
<p>就像我们之前做的那样,或者使用 <strong>EXISTS</strong>：</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">EXISTS</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">books_awards</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ba</span>
<span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">ba</span><span class="p">.</span><span class="n">book_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">book_id</span><span class="p">)</span>
<span class="p">;</span>
</code></pre></div>
</div>
<p>你还可以使用 <strong>NOT EXISTS</strong>,它的值为 <strong>EXISTS</strong> 的布尔反值。</p>
</div>
<div class="tabbed-block docutils">
<p>The <strong>EXISTS</strong> operator precedes a subquery, which is the only operand.  An <strong>EXISTS</strong> expression evaluates to <code class="docutils literal notranslate"><span class="pre">True</span></code> only if the subquery returns one or more rows.  The actual data from the subquery is ignored, so you can put anything you want in the <strong>SELECT</strong> clause.  We will use a constant <code class="docutils literal notranslate"><span class="pre">1</span></code> in our examples, just to emphasize that the data we are returning is unimportant.</p>
<p>Many uncorrelated subqueries can be rewritten as correlated subqueries using <strong>EXISTS</strong>.  For example, to find all books that have won awards, we can either write</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">book_id</span><span class="w"> </span><span class="k">IN</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">book_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books_awards</span><span class="p">)</span>
<span class="p">;</span>
</code></pre></div>
</div>
<p>as we did earlier, or, using <strong>EXISTS</strong>:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">EXISTS</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">books_awards</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ba</span>
<span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">ba</span><span class="p">.</span><span class="n">book_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">book_id</span><span class="p">)</span>
<span class="p">;</span>
</code></pre></div>
</div>
<p>You can also use <strong>NOT EXISTS</strong>, which evaluates to the Boolean inverse of <strong>EXISTS</strong>.</p>
</div>
</div>
</div><h2 id="id9"><span class="section-number">1.8.5. </span>其他子句中的子查询<a class="headerlink" href="#id9" title="Link to this heading">¶</a></h2>
<p><strong>Subqueries in other clauses</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="12:2">
<input checked type="radio" id="__tabbed_12_1" name="__tabbed_12"><input type="radio" id="__tabbed_12_2" name="__tabbed_12"><div class="tabbed-labels docutils">
<label class="tabbed-label" for="__tabbed_12_1">
中文</label><label class="tabbed-label" for="__tabbed_12_2">
英文</label></div>
<div class="tabbed-content docutils">
<div class="tabbed-block docutils">
<p>我们已经看到许多在 <strong>WHERE</strong> 子句中使用子查询的示例。然而,子查询表达式可以在其他上下文中使用。特别是,返回标量的子查询可以在 <strong>SELECT</strong> 子句和 <strong>UPDATE</strong> 语句的 <strong>SET</strong> 子句中非常有用。返回表的子查询也可以用作 <strong>SELECT</strong> 子句的 <strong>FROM</strong> 子句中的命名表。</p>
</div>
<div class="tabbed-block docutils">
<p>We have seen numerous examples of subqueries used in <strong>WHERE</strong> clauses.  However, subquery expressions can be used in other contexts.  In particular, subqueries returning scalars can be useful in <strong>SELECT</strong> clauses and in the <strong>SET</strong> clauses of <strong>UPDATE</strong> statements.  Subqueries returning tables can also be used in place of named tables in the <strong>FROM</strong> clause of a <strong>SELECT</strong> clause.</p>
</div>
</div>
</div><h3 id="select"><span id="index-8"></span><span class="section-number">1.8.5.1. </span>SELECT<a class="headerlink" href="#select" title="Link to this heading">¶</a></h3>
<p><strong>SELECT</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="13:2">
<input checked type="radio" id="__tabbed_13_1" name="__tabbed_13"><input type="radio" id="__tabbed_13_2" name="__tabbed_13"><div class="tabbed-labels docutils">
<label class="tabbed-label" for="__tabbed_13_1">
中文</label><label class="tabbed-label" for="__tabbed_13_2">
英文</label></div>
<div class="tabbed-content docutils">
<div class="tabbed-block docutils">
<p>在 <strong>SELECT</strong> 子句中,子查询可以用来检索不容易从外部查询使用的表中获得的值。以这种方式使用时,子查询必须返回一个标量。这些子查询几乎总是相关的,因为我们希望返回特定于每一行的值。</p>
<p>例如,在一本书的列表中,我们可能希望包括作者撰写的书籍总数。为此,我们将使用聚合表达式 <strong>COUNT(*)</strong>,它简单地计算与 <strong>SELECT</strong> 查询中的 <strong>WHERE</strong> 子句匹配的行数 <a class="footnote-reference brackets" href="#id14" id="id10" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> . (聚合函数在 <a class="reference internal" href="../09-grouping-and-aggregation/grouping-and-aggregation.html#grouping-chapter"><span class="std std-numref">Chapter 1.9</span></a> 中将详细讨论。)</p>
<p>download: <a class="reference external" href="/_static/textbook.sqlite3">sqlite3 file</a></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="n">subqueries_example_other_clauses</span>

<span class="k">SELECT</span>
<span class="w">  </span><span class="n">a</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">author</span><span class="p">,</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b2</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">b2</span><span class="p">.</span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">author_id</span><span class="p">)</span>
<span class="w">    </span><span class="k">AS</span><span class="w"> </span><span class="n">author_total</span><span class="p">,</span>
<span class="w">  </span><span class="n">b1</span><span class="p">.</span><span class="n">title</span>
<span class="k">FROM</span>
<span class="w">  </span><span class="n">authors</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a</span>
<span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b1</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">b1</span><span class="p">.</span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">author_id</span>
<span class="p">;</span>
</code></pre></div>
</div>
</div>
<div class="tabbed-block docutils">
<p>Used in a <strong>SELECT</strong> clause, subqueries can be used to retrieve values that are not easily obtained from the tables used in the outer query.  Used in this way, the subquery must return a scalar.  These subqueries are almost always correlated, as we want to return a value that is specific to each row.</p>
<p>For example, in a listing of books, we might want to include the total number of books written by the author.  For this we will use the aggregate expression <strong>COUNT(*)</strong>, which simply counts the number of rows matching the <strong>WHERE</strong> clause in a <strong>SELECT</strong> query <a class="footnote-reference brackets" href="#id15" id="id11" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>.  (Aggregates are discussed fully in <a class="reference internal" href="../09-grouping-and-aggregation/grouping-and-aggregation.html#grouping-chapter"><span class="std std-numref">Chapter 1.9</span></a>.)</p>
<p>download: <a class="reference external" href="/_static/textbook.sqlite3">sqlite3 file</a></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="n">subqueries_example_other_clauses</span>

<span class="k">SELECT</span>
<span class="w">  </span><span class="n">a</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">author</span><span class="p">,</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b2</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">b2</span><span class="p">.</span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">author_id</span><span class="p">)</span>
<span class="w">    </span><span class="k">AS</span><span class="w"> </span><span class="n">author_total</span><span class="p">,</span>
<span class="w">  </span><span class="n">b1</span><span class="p">.</span><span class="n">title</span>
<span class="k">FROM</span>
<span class="w">  </span><span class="n">authors</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a</span>
<span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b1</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">b1</span><span class="p">.</span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">author_id</span>
<span class="p">;</span>
</code></pre></div>
</div>
</div>
</div>
</div><h3 id="set"><span id="index-9"></span><span class="section-number">1.8.5.2. </span>SET<a class="headerlink" href="#set" title="Link to this heading">¶</a></h3>
<p><strong>SET</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="14:2">
<input checked type="radio" id="__tabbed_14_1" name="__tabbed_14"><input type="radio" id="__tabbed_14_2" name="__tabbed_14"><div class="tabbed-labels docutils">
<label class="tabbed-label" for="__tabbed_14_1">
中文</label><label class="tabbed-label" for="__tabbed_14_2">
英文</label></div>
<div class="tabbed-content docutils">
<div class="tabbed-block docutils">
<p>在 <strong>UPDATE</strong> 语句的 <strong>SET</strong> 子句中,子查询提供了一种解决我们无法在 <strong>UPDATE</strong> 中使用连接的问题的方法。如果我们想用第二个表中的数据更新某个表中的行,可以简单地使用子查询来获取适当的值。</p>
<p>作为一个例子,在为本书的数据库做准备时,运行了一条语句来使用书籍版本信息填充 <strong>books</strong> 表中的 <strong>publication_year</strong> 列。(数据库中的 <strong>editions</strong> 表仅包含少数书籍的条目,以保持大小可控,但原始数据库有完整的数据。)该语句使用另一个聚合表达式来获取每本书在版本表中的最早出版年份：</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">UPDATE</span><span class="w"> </span><span class="n">books</span>
<span class="k">SET</span><span class="w"> </span><span class="n">publication_year</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">MIN</span><span class="p">(</span><span class="n">publication_year</span><span class="p">)</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">editions</span>
<span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">books</span><span class="p">.</span><span class="n">book_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">editions</span><span class="p">.</span><span class="n">book_id</span><span class="p">)</span>
<span class="p">;</span>
</code></pre></div>
</div>
<p>注意：如果您运行上述语句,大多数书籍的出版年份将被更新为 <code class="docutils literal notranslate"><span class="pre">NULL</span></code> - 当子查询返回零行时,结果被解释为 <code class="docutils literal notranslate"><span class="pre">NULL</span></code>。(如果您执行了此语句,请不要担心 - 变更仅会对数据的副本进行。您可以通过刷新浏览器窗口获取未修改的数据库副本。)您可以修改该语句,仅更新我们有版本数据的行,使用另一个子查询：</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">UPDATE</span><span class="w"> </span><span class="n">books</span>
<span class="k">SET</span><span class="w"> </span><span class="n">publication_year</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">MIN</span><span class="p">(</span><span class="n">publication_year</span><span class="p">)</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">editions</span>
<span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">books</span><span class="p">.</span><span class="n">book_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">editions</span><span class="p">.</span><span class="n">book_id</span><span class="p">)</span>
<span class="k">WHERE</span><span class="w"> </span><span class="k">EXISTS</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">editions</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">books</span><span class="p">.</span><span class="n">book_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">editions</span><span class="p">.</span><span class="n">book_id</span><span class="p">)</span>
<span class="p">;</span>
</code></pre></div>
</div>
</div>
<div class="tabbed-block docutils">
<p>Used in the <strong>SET</strong> clause of an <strong>UPDATE</strong> statement, subqueries provide a way to work around the issue that we cannot use joins in an <strong>UPDATE</strong>.  If we want to update rows in some table with data from a second table, we can simply use a subquery to obtain the proper value.</p>
<p>As an example, in preparation of this book’s database, a statement was run to populate the <strong>publication_year</strong> column of <strong>books</strong> using book edition information.  (The <strong>editions</strong> table in the database only has entries for a few books, to keep the size manageable, but the original database had complete data.)  This statement uses another aggregate expression to obtain the earliest publication year from the editions table for each book:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">UPDATE</span><span class="w"> </span><span class="n">books</span>
<span class="k">SET</span><span class="w"> </span><span class="n">publication_year</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">MIN</span><span class="p">(</span><span class="n">publication_year</span><span class="p">)</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">editions</span>
<span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">books</span><span class="p">.</span><span class="n">book_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">editions</span><span class="p">.</span><span class="n">book_id</span><span class="p">)</span>
<span class="p">;</span>
</code></pre></div>
</div>
<p>Note: if you run the statement above, you will update most books to have a <code class="docutils literal notranslate"><span class="pre">NULL</span></code> publication year - when the subquery returns zero rows, the result is interpreted as <code class="docutils literal notranslate"><span class="pre">NULL</span></code>.  (Do not worry if you executed this statement - changes are only made to a copy of the data.  You can obtain an unmodified copy of the database by refreshing your browser window.)  You can modify the statement to only update rows for which we have editions data using another subquery:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">UPDATE</span><span class="w"> </span><span class="n">books</span>
<span class="k">SET</span><span class="w"> </span><span class="n">publication_year</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">MIN</span><span class="p">(</span><span class="n">publication_year</span><span class="p">)</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">editions</span>
<span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">books</span><span class="p">.</span><span class="n">book_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">editions</span><span class="p">.</span><span class="n">book_id</span><span class="p">)</span>
<span class="k">WHERE</span><span class="w"> </span><span class="k">EXISTS</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">editions</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">books</span><span class="p">.</span><span class="n">book_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">editions</span><span class="p">.</span><span class="n">book_id</span><span class="p">)</span>
<span class="p">;</span>
</code></pre></div>
</div>
</div>
</div>
</div><h3 id="from"><span id="index-10"></span><span class="section-number">1.8.5.3. </span>FROM<a class="headerlink" href="#from" title="Link to this heading">¶</a></h3>
<p><strong>FROM</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="15:2">
<input checked type="radio" id="__tabbed_15_1" name="__tabbed_15"><input type="radio" id="__tabbed_15_2" name="__tabbed_15"><div class="tabbed-labels docutils">
<label class="tabbed-label" for="__tabbed_15_1">
中文</label><label class="tabbed-label" for="__tabbed_15_2">
英文</label></div>
<div class="tabbed-content docutils">
<div class="tabbed-block docutils">
<p>子查询也可以用于 <strong>SELECT</strong> 查询的 <strong>FROM</strong> 子句,在这种情况下,子查询的结果就像一个表,包含子查询返回的确切数据。在这种用法中,子查询表达式 <em>必须</em> 使用别名命名。子查询不能是相关的！子查询表达式可以用于获取在数据库中任何表中不可用的计算数据。例如,上面我们使用了一个相关子查询逐行检索作者的书籍数量以配合每个书名。我们可以改为使用一个不相关的子查询计算所有作者的总数,然后将每个结果像表一样连接到主查询中。(这里的子查询使用了分组和聚合,详见 <a class="reference internal" href="../09-grouping-and-aggregation/grouping-and-aggregation.html#grouping-chapter"><span class="std std-numref">Chapter 1.9</span></a>。)</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span>
<span class="w">  </span><span class="n">a</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">author</span><span class="p">,</span>
<span class="w">  </span><span class="k">c</span><span class="p">.</span><span class="k">count</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">author_total</span><span class="p">,</span>
<span class="w">  </span><span class="n">b</span><span class="p">.</span><span class="n">title</span>
<span class="k">FROM</span>
<span class="w">  </span><span class="n">authors</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a</span>
<span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">author_id</span>
<span class="w">  </span><span class="k">JOIN</span>
<span class="w">    </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">author_id</span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">count</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span>
<span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">author_id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">c</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">author_id</span>
<span class="p">;</span>
</code></pre></div>
</div>
</div>
<div class="tabbed-block docutils">
<p>Subqueries can also be used within the <strong>FROM</strong> clause of a <strong>SELECT</strong> query, in which case the subquery result acts like a table containing exactly the data returned by the subquery.  In this usage, the subquery expression <em>must</em> be given a name using aliasing.  The subquery cannot be correlated!  The subquery expression can be used to obtain computed data not available in any table in the database.  For example, above we used a correlated subquery to retrieve author’s book counts on a row-by-row basis to go with each book title.  We could instead compute all author totals using an uncorrelated subquery, and then join each to the result as if it were a table.  (Here the subquery uses both grouping and aggregation, covered in <a class="reference internal" href="../09-grouping-and-aggregation/grouping-and-aggregation.html#grouping-chapter"><span class="std std-numref">Chapter 1.9</span></a>.)</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span>
<span class="w">  </span><span class="n">a</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">author</span><span class="p">,</span>
<span class="w">  </span><span class="k">c</span><span class="p">.</span><span class="k">count</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">author_total</span><span class="p">,</span>
<span class="w">  </span><span class="n">b</span><span class="p">.</span><span class="n">title</span>
<span class="k">FROM</span>
<span class="w">  </span><span class="n">authors</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a</span>
<span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">author_id</span>
<span class="w">  </span><span class="k">JOIN</span>
<span class="w">    </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">author_id</span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">count</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span>
<span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">author_id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">c</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">author_id</span>
<span class="p">;</span>
</code></pre></div>
</div>
</div>
</div>
</div><h2 id="index-11"><span id="id12"></span><span class="section-number">1.8.6. </span>与连接的比较<a class="headerlink" href="#index-11" title="Link to this heading">¶</a></h2>
<p><strong>Comparison with joins</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="16:2">
<input checked type="radio" id="__tabbed_16_1" name="__tabbed_16"><input type="radio" id="__tabbed_16_2" name="__tabbed_16"><div class="tabbed-labels docutils">
<label class="tabbed-label" for="__tabbed_16_1">
中文</label><label class="tabbed-label" for="__tabbed_16_2">
英文</label></div>
<div class="tabbed-content docutils">
<div class="tabbed-block docutils">
<p>子查询在某种意义上可以与连接比较,因为它们都涉及多个表。在许多情况下,子查询可以替代连接,反之亦然。然而,它们之间存在一些微妙的差异。</p>
<p>首先,当然,除了使用 <strong>SELECT</strong> 子句的子查询外,你只能返回外部查询表中实际出现的数据。如果需要结果包含多个表中的数据,通常最好是连接这些表,而不是使用 <strong>SELECT</strong> 子句的子查询。(上面使用的 <strong>SELECT</strong> 子句子查询的例子是一个例外,因为我们提取的数据实际上并没有存储在任何表中。)对于每个所需列使用单独的子查询是笨拙的,难以阅读,并且可能效率低下。</p>
<p>另一方面,如果你仅从一个表中检索数据,使用子查询有时是有利的。考虑以下两个查询来检索获奖的书籍：</p>
<p>download: <a class="reference external" href="/_static/textbook.sqlite3">sqlite3 file</a></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="n">subqueries_example_comparison</span>

<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">book_id</span><span class="w"> </span><span class="k">IN</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">book_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books_awards</span><span class="p">)</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">title</span><span class="p">;</span>

<span class="k">SELECT</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="o">*</span>
<span class="k">FROM</span>
<span class="w">  </span><span class="n">books</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b</span>
<span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="n">books_awards</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ba</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">ba</span><span class="p">.</span><span class="n">book_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">book_id</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">title</span><span class="p">;</span>
</code></pre></div>
</div>
<p>这两个查询返回相同的数据,但第二个查询有重复行——每本书因为获得的奖项而出现多次。在第一个查询中,**IN** 操作符仅测试书籍在奖项表中的存在性,而不是它出现的次数,因此避免了重复。</p>
<p><strong>NOT EXISTS</strong> 和 <strong>NOT IN</strong> 操作符尤其有趣,因为它们可以为那些否则需要外连接的问题提供清晰的解决方案,例如列出未获奖的书籍。</p>
<p>然而,在许多情况下,你在处理查询时有多种选择。你使用哪种方式取决于个人喜好和风格。以下是三种不同的查询,用于查找与作者去世年份相同的书籍——一种使用不相关的子查询(重复前面的内容),一种使用带有 <strong>EXISTS</strong> 的相关子查询,另一种使用连接：</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">author</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">publication_year</span>
<span class="k">FROM</span>
<span class="w">  </span><span class="n">authors</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a</span>
<span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">author_id</span>
<span class="k">WHERE</span>
<span class="w">  </span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">author_id</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">publication_year</span><span class="p">)</span><span class="w"> </span><span class="k">IN</span>
<span class="w">    </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">author_id</span><span class="p">,</span><span class="w"> </span><span class="k">substring</span><span class="p">(</span><span class="n">death</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">authors</span><span class="p">)</span>
<span class="p">;</span>

<span class="k">SELECT</span><span class="w"> </span><span class="n">a1</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">author</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">publication_year</span>
<span class="k">FROM</span>
<span class="w">  </span><span class="n">authors</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a1</span>
<span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">a1</span><span class="p">.</span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">author_id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="k">EXISTS</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">authors</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a2</span>
<span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">a2</span><span class="p">.</span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a1</span><span class="p">.</span><span class="n">author_id</span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="k">substring</span><span class="p">(</span><span class="n">a2</span><span class="p">.</span><span class="n">death</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">publication_year</span><span class="p">)</span>
<span class="p">;</span>

<span class="k">SELECT</span><span class="w"> </span><span class="n">a1</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">author</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">publication_year</span>
<span class="k">FROM</span>
<span class="w">  </span><span class="n">authors</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a1</span>
<span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">a1</span><span class="p">.</span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">author_id</span>
<span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="n">authors</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a2</span><span class="w"> </span><span class="k">ON</span>
<span class="w">    </span><span class="n">a2</span><span class="p">.</span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a1</span><span class="p">.</span><span class="n">author_id</span>
<span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="k">substring</span><span class="p">(</span><span class="n">a2</span><span class="p">.</span><span class="n">death</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">publication_year</span>
<span class="p">;</span>
</code></pre></div>
</div>
</div>
<div class="tabbed-block docutils">
<p>Subqueries are comparable to joins in the sense that they both involve multiple tables.  There are many cases in which a subquery can substitute for a join or vice-versa.  However, there are some subtle differences.</p>
<p>First, of course, is that short of using <strong>SELECT</strong> clause subqueries, you can only return data that actually appears in the outer query’s tables.  If you need your result to contain data contained in multiple tables, it is generally best to join the tables rather than using <strong>SELECT</strong> clause subqueries.  (The example used above of a <strong>SELECT</strong> clause subquery is an exception, since the data we pulled in was not actually stored in any table.)  Using a separate subquery for each column needed is unwieldy, hard to read, and probably inefficient.</p>
<p>On the other hand, if you are retrieving data from one table only, it is sometimes advantageous to use a subquery.  Consider these two queries to retrieve books that have won awards:</p>
<p>download: <a class="reference external" href="/_static/textbook.sqlite3">sqlite3 file</a></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="n">subqueries_example_comparison</span>

<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">book_id</span><span class="w"> </span><span class="k">IN</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">book_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books_awards</span><span class="p">)</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">title</span><span class="p">;</span>

<span class="k">SELECT</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="o">*</span>
<span class="k">FROM</span>
<span class="w">  </span><span class="n">books</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b</span>
<span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="n">books_awards</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ba</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">ba</span><span class="p">.</span><span class="n">book_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">book_id</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">title</span><span class="p">;</span>
</code></pre></div>
</div>
<p>Both queries return the same data, but the second query has duplicate rows - each book appears once for each award it has won.  In the first query, the <strong>IN</strong> operator merely tests for the presence of a book in the awards table, not how many times it appears, so duplicates are avoided.</p>
<p>The <strong>NOT EXISTS</strong> and <strong>NOT IN</strong> operators are particularly interesting in that they can provide clean solutions to questions that otherwise require an outer join, such as listing the books which have <em>not</em> won awards.</p>
<p>In many cases, though, you have choices in how you approach a query.  Which you use depends on your personal preference and style.  Here are three different queries for finding books published in the same year as the author’s death - one using an uncorrelated subquery (repeated from above), one using a correlated subquery with <strong>EXISTS</strong>, and one using a join:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">author</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">publication_year</span>
<span class="k">FROM</span>
<span class="w">  </span><span class="n">authors</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a</span>
<span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">author_id</span>
<span class="k">WHERE</span>
<span class="w">  </span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">author_id</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">publication_year</span><span class="p">)</span><span class="w"> </span><span class="k">IN</span>
<span class="w">    </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">author_id</span><span class="p">,</span><span class="w"> </span><span class="k">substring</span><span class="p">(</span><span class="n">death</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">authors</span><span class="p">)</span>
<span class="p">;</span>

<span class="k">SELECT</span><span class="w"> </span><span class="n">a1</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">author</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">publication_year</span>
<span class="k">FROM</span>
<span class="w">  </span><span class="n">authors</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a1</span>
<span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">a1</span><span class="p">.</span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">author_id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="k">EXISTS</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">authors</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a2</span>
<span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">a2</span><span class="p">.</span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a1</span><span class="p">.</span><span class="n">author_id</span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="k">substring</span><span class="p">(</span><span class="n">a2</span><span class="p">.</span><span class="n">death</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">publication_year</span><span class="p">)</span>
<span class="p">;</span>

<span class="k">SELECT</span><span class="w"> </span><span class="n">a1</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">author</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">publication_year</span>
<span class="k">FROM</span>
<span class="w">  </span><span class="n">authors</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a1</span>
<span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">a1</span><span class="p">.</span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">author_id</span>
<span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="n">authors</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a2</span><span class="w"> </span><span class="k">ON</span>
<span class="w">    </span><span class="n">a2</span><span class="p">.</span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a1</span><span class="p">.</span><span class="n">author_id</span>
<span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="k">substring</span><span class="p">(</span><span class="n">a2</span><span class="p">.</span><span class="n">death</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">publication_year</span>
<span class="p">;</span>
</code></pre></div>
</div>
</div>
</div>
</div><h2 id="id13"><span class="section-number">1.8.7. </span>自检练习<a class="headerlink" href="#id13" title="Link to this heading">¶</a></h2>
<p><strong>Self-check exercises</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="17:2">
<input checked type="radio" id="__tabbed_17_1" name="__tabbed_17"><input type="radio" id="__tabbed_17_2" name="__tabbed_17"><div class="tabbed-labels docutils">
<label class="tabbed-label" for="__tabbed_17_1">
中文</label><label class="tabbed-label" for="__tabbed_17_2">
英文</label></div>
<div class="tabbed-content docutils">
<div class="tabbed-block docutils">
<p>本节包含一些使用书籍数据集的练习(提醒：你可以在 <a class="reference internal" href="../../appendix-a-datasets/datasets.html#appendix-a"><span class="std std-ref">Appendix A</span></a> 中获取所有表的完整描述)。如果遇到困难,可以点击练习下方的“显示答案”按钮查看正确答案。回答这些问题的方法有很多;请尽量为每个问题使用至少一个子查询。</p>
<ul class="simple">
<li><p>编写查询列出作者 Viet Thanh Nguyen 的书籍(标题、出版年份)。</p></li>
</ul>
<div class="dropdown admonition">
<p class="admonition-title">显示答案</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">authors</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Viet Thanh Nguyen&#39;</span><span class="p">)</span>
<span class="p">;</span>
</code></pre></div>
</div>
</div>
<ul class="simple">
<li><p>编写查询给出《How We Became Human》的作者。</p></li>
</ul>
<div class="dropdown admonition">
<p class="admonition-title">显示答案</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">authors</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;How We Became Human&#39;</span><span class="p">)</span>
<span class="p">;</span>
</code></pre></div>
</div>
</div>
<ul class="simple">
<li><p>编写查询列出出生在作者阿尔贝·加缪去世之后的作者。</p></li>
</ul>
<div class="dropdown admonition">
<p class="admonition-title">显示答案</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">authors</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">birth</span><span class="w"> </span><span class="o">&gt;</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">death</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">authors</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Albert Camus&#39;</span><span class="p">)</span>
<span class="p">;</span>
</code></pre></div>
</div>
</div>
<ul class="simple">
<li><p>编写查询列出我们有版本信息的书籍。</p></li>
</ul>
<div class="dropdown admonition">
<p class="admonition-title">显示答案</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">book_id</span><span class="w"> </span><span class="k">IN</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">book_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">editions</span><span class="p">)</span>
<span class="p">;</span>
</code></pre></div>
</div>
</div>
<ul class="simple">
<li><p>编写查询列出现存作者的书籍标题(假设 <code class="docutils literal notranslate"><span class="pre">NULL</span></code> 的死亡日期表示作者仍在世)。</p></li>
</ul>
<div class="dropdown admonition">
<p class="admonition-title">显示答案</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="k">IN</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">authors</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">death</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="p">)</span>
<span class="p">;</span>
</code></pre></div>
</div>
</div>
<ul class="simple">
<li><p>编写查询列出获得诺贝尔文学奖的作者(作者奖项)。</p></li>
</ul>
<div class="dropdown admonition">
<p class="admonition-title">显示答案</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">authors</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="k">IN</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">authors_awards</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">award_id</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">award_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">awards</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Nobel Prize in Literature&#39;</span><span class="p">))</span>
<span class="p">;</span>
</code></pre></div>
</div>
</div>
<ul class="simple">
<li><p>编写查询列出其书籍获得任何种类普利策奖的作者(书籍奖项以字符串 ‘Pulitzer’ 开头)。</p></li>
</ul>
<div class="dropdown admonition">
<p class="admonition-title">显示答案</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">authors</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="k">IN</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">book_id</span><span class="w"> </span><span class="k">IN</span>
<span class="w">    </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">book_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books_awards</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">award_id</span><span class="w"> </span><span class="k">IN</span>
<span class="w">      </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">award_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">awards</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;Pulitzer%&#39;</span><span class="p">)))</span>
<span class="p">;</span>
</code></pre></div>
</div>
</div>
<ul class="simple">
<li><p>编写查询列出获得书籍奖项但未获得作者奖项的作者。</p></li>
</ul>
<div class="dropdown admonition">
<p class="admonition-title">显示答案</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">name</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">authors</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="k">IN</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">book_id</span><span class="w"> </span><span class="k">IN</span>
<span class="w">    </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">book_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books_awards</span><span class="p">))</span>
<span class="k">AND</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">authors_awards</span><span class="p">)</span>
<span class="p">;</span>
</code></pre></div>
</div>
</div>
<ul class="simple">
<li><p>编写查询查找只有一本书的作者的书籍(根据我们的数据库)。<em>提示</em>：一种方法是问,对于每本书,是否存在该作者的*其他*书籍。</p></li>
</ul>
<div class="dropdown admonition">
<p class="admonition-title">显示答案</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">b1</span><span class="p">.</span><span class="n">title</span>
<span class="k">FROM</span>
<span class="w">  </span><span class="n">authors</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a</span>
<span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b1</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b1</span><span class="p">.</span><span class="n">author_id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b2</span>
<span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">b2</span><span class="p">.</span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b1</span><span class="p">.</span><span class="n">author_id</span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">b2</span><span class="p">.</span><span class="n">book_id</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="n">b1</span><span class="p">.</span><span class="n">book_id</span><span class="p">)</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">name</span><span class="p">;</span><span class="w">  </span><span class="c1">-- 以便更容易验证</span>
</code></pre></div>
</div>
</div>
<ul class="simple">
<li><p>编写查询列出作者 J. M. Coetzee 获得的所有奖项(作者奖项或书籍奖项)。</p></li>
</ul>
<div class="dropdown admonition">
<p class="admonition-title">显示答案</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">name</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">awards</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">award_id</span><span class="w"> </span><span class="k">IN</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">award_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">authors_awards</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">authors</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;J. M. Coetzee&#39;</span><span class="p">))</span>
<span class="k">OR</span><span class="w"> </span><span class="n">award_id</span><span class="w"> </span><span class="k">IN</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">award_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books_awards</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">book_id</span><span class="w"> </span><span class="k">IN</span>
<span class="w">    </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">book_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span>
<span class="w">      </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">authors</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;J. M. Coetzee&#39;</span><span class="p">)))</span>
<span class="p">;</span>
</code></pre></div>
</div>
</div>
</div>
<div class="tabbed-block docutils">
<p>This section contains some exercises using the books data set (reminder: you can get full descriptions of all tables in <a class="reference internal" href="../../appendix-a-datasets/datasets.html#appendix-a"><span class="std std-ref">Appendix A</span></a>).  If you get stuck, click on the “Show answer” button below the exercise to see a correct answer.  There are many ways to answer these questions; try to use at least one subquery for each.</p>
<ul class="simple">
<li><p>Write a query to list books (title, publication_year) by the author Viet Thanh Nguyen.</p></li>
</ul>
<div class="dropdown admonition">
<p class="admonition-title">Show answer</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">authors</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Viet Thanh Nguyen&#39;</span><span class="p">)</span>
<span class="p">;</span>
</code></pre></div>
</div>
</div>
<ul class="simple">
<li><p>Write a query giving the author of <em>How We Became Human</em>.</p></li>
</ul>
<div class="dropdown admonition">
<p class="admonition-title">Show answer</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">authors</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;How We Became Human&#39;</span><span class="p">)</span>
<span class="p">;</span>
</code></pre></div>
</div>
</div>
<ul class="simple">
<li><p>Write a query to list authors born after the death of author Albert Camus.</p></li>
</ul>
<div class="dropdown admonition">
<p class="admonition-title">Show answer</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">authors</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">birth</span><span class="w"> </span><span class="o">&gt;</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">death</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">authors</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Albert Camus&#39;</span><span class="p">)</span>
<span class="p">;</span>
</code></pre></div>
</div>
</div>
<ul class="simple">
<li><p>Write a query to list books for which we have editions information.</p></li>
</ul>
<div class="dropdown admonition">
<p class="admonition-title">Show answer</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">book_id</span><span class="w"> </span><span class="k">IN</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">book_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">editions</span><span class="p">)</span>
<span class="p">;</span>
</code></pre></div>
</div>
</div>
<ul class="simple">
<li><p>Write a query to list the titles of books by living authors (assume a <code class="docutils literal notranslate"><span class="pre">NULL</span></code> death date means the author is living).</p></li>
</ul>
<div class="dropdown admonition">
<p class="admonition-title">Show answer</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="k">IN</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">authors</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">death</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="p">)</span>
<span class="p">;</span>
</code></pre></div>
</div>
</div>
<ul class="simple">
<li><p>Write a query to list the authors who have won the Nobel Prize in Literature (an author award).</p></li>
</ul>
<div class="dropdown admonition">
<p class="admonition-title">Show answer</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">authors</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="k">IN</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">authors_awards</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">award_id</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">award_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">awards</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Nobel Prize in Literature&#39;</span><span class="p">))</span>
<span class="p">;</span>
</code></pre></div>
</div>
</div>
<ul class="simple">
<li><p>Write a query to list the authors whose books have won any kind of Pulitzer prize (a book award starting with the string ‘Pulitzer’).</p></li>
</ul>
<div class="dropdown admonition">
<p class="admonition-title">Show answer</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">authors</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="k">IN</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">book_id</span><span class="w"> </span><span class="k">IN</span>
<span class="w">    </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">book_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books_awards</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">award_id</span><span class="w"> </span><span class="k">IN</span>
<span class="w">      </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">award_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">awards</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;Pulitzer%&#39;</span><span class="p">)))</span>
<span class="p">;</span>
</code></pre></div>
</div>
</div>
<ul class="simple">
<li><p>Write a query to list authors who have won book awards but not author awards.</p></li>
</ul>
<div class="dropdown admonition">
<p class="admonition-title">Show answer</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">name</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">authors</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="k">IN</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">book_id</span><span class="w"> </span><span class="k">IN</span>
<span class="w">    </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">book_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books_awards</span><span class="p">))</span>
<span class="k">AND</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">authors_awards</span><span class="p">)</span>
<span class="p">;</span>
</code></pre></div>
</div>
</div>
<ul class="simple">
<li><p>Write a query to find books by authors with only one book (according to our database).  <em>Hint</em>: one way is to ask, for each book, whether there exist <em>other</em> books by the same author.</p></li>
</ul>
<div class="dropdown admonition">
<p class="admonition-title">Show answer</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">b1</span><span class="p">.</span><span class="n">title</span>
<span class="k">FROM</span>
<span class="w">  </span><span class="n">authors</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a</span>
<span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b1</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b1</span><span class="p">.</span><span class="n">author_id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b2</span>
<span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">b2</span><span class="p">.</span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b1</span><span class="p">.</span><span class="n">author_id</span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">b2</span><span class="p">.</span><span class="n">book_id</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="n">b1</span><span class="p">.</span><span class="n">book_id</span><span class="p">)</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">name</span><span class="p">;</span><span class="w">  </span><span class="c1">-- to make it easier to verify</span>
</code></pre></div>
</div>
</div>
<ul class="simple">
<li><p>Write a query to list all awards (either author awards or book awards) won by author J. M. Coetzee.</p></li>
</ul>
<div class="dropdown admonition">
<p class="admonition-title">Show answer</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">name</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">awards</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">award_id</span><span class="w"> </span><span class="k">IN</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">award_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">authors_awards</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">authors</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;J. M. Coetzee&#39;</span><span class="p">))</span>
<span class="k">OR</span><span class="w"> </span><span class="n">award_id</span><span class="w"> </span><span class="k">IN</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">award_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books_awards</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">book_id</span><span class="w"> </span><span class="k">IN</span>
<span class="w">    </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">book_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span>
<span class="w">      </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">authors</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;J. M. Coetzee&#39;</span><span class="p">)))</span>
<span class="p">;</span>
</code></pre></div>
</div>
</div>
</div>
</div>
</div><hr class="docutils" />
<p><strong>Notes</strong></p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id14" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id10">1</a><span class="fn-bracket">]</span></span>
<p>对于这个特定问题,我们可以使用一种叫做 <em>窗口函数</em> 的方法,这将在 <a class="reference internal" href="../11-advanced-topics/advanced-topics.html#advanced-sql-chapter"><span class="std std-numref">Chapter 1.11</span></a> 中简要讨论。</p>
</aside>
<aside class="footnote brackets" id="id15" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id11">2</a><span class="fn-bracket">]</span></span>
<p>For this particular problem, we could instead use something called a <em>window function</em>, which will be discussed briefly in <a class="reference internal" href="../11-advanced-topics/advanced-topics.html#advanced-sql-chapter"><span class="std std-numref">Chapter 1.11</span></a>.</p>
</aside>
</aside>






                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../07-constraints/constraints.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: 1.7. 键和约束" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              1.7. 键和约束
            </div>
          </div>
        </a>
      
      
        
        <a href="../09-grouping-and-aggregation/grouping-and-aggregation.html" class="md-footer__link md-footer__link--next" aria-label="Next: 1.9. 分组和聚合" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              1.9. 分组和聚合
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  
  
  <div class="md-footer-meta md-typeset">
    
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-footer-copyright__highlight">
        &#169; Copyright 2024, Christopher Painter&amp;#8209;Wakefield.
        
    </div>
  
    Created using
    <a href="https://www.sphinx-doc.org/" target="_blank" rel="noopener">Sphinx</a>
    8.1.3.
     and
    <a href="https://github.com/jbms/sphinx-immaterial/" target="_blank" rel="noopener">Sphinx-Immaterial</a>
  
</div>
      
    </div>
    
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.top", "search.share", "toc.follow", "toc.sticky", "content.tabs.link", "announce.dismiss"], "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"provider": "mike", "staticVersions": null, "versionPath": null}}</script>
    
      
        <script src="../../_static/sphinx_immaterial_theme.f9d9eeeb247ace16c.min.js?v=8ec58cb5"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    
  </body>
</html>