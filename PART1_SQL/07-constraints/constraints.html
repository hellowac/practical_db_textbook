

<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="">
    
    
      
        <title>1.7. 键和约束 - 数据库实用入门  documentation</title>
      
    
    
      
        
        
      
      

    
    
    
      
        
        
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
        <link rel="stylesheet" type="text/css" href="../../_static/sphinx_immaterial_theme.4b4a8c74e2ff2ab5b.min.css?v=afa97f93" />
        <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="light-green" data-md-color-accent="light-blue">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#id2" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../index.html" title="数据库实用入门  documentation" class="md-header__button md-logo" aria-label="数据库实用入门  documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>
    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            数据库实用入门  documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              1.7. 键和约束
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="light-green" data-md-color-accent="light-blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="deep-orange" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/hellowac/practical_db_textbook-zh-cn/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    practical_db_textbook-zh-cn
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../front-matter/preface.html" class="md-tabs__link">
      <span class="md-ellipsis">前言</span>
    </a>
  </li>

      
        
  
  
    
  


  <li class="md-tabs__item">
    <a href="../index.html" class="md-tabs__link md-tabs__link--active">
      <span class="md-ellipsis">SQL</span>
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../PART2_DATA_MODELING/index.html" class="md-tabs__link">
      <span class="md-ellipsis">数据模型</span>
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../PART3_RELATIONAL_DATABASE_THEORY/index.html" class="md-tabs__link">
      <span class="md-ellipsis">关系数据库理论</span>
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../references/references.html" class="md-tabs__link">
      <span class="md-ellipsis">引用</span>
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../appendix-a-datasets/datasets.html" class="md-tabs__link">
      <span class="md-ellipsis">Appendix A:<wbr> 本书使用的示例数据集</span>
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../appendix-b-reference/reference.html" class="md-tabs__link">
      <span class="md-ellipsis">Appendix B:<wbr> SQL 参考</span>
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../front-matter/acknowledgments.html" class="md-tabs__link">
      <span class="md-ellipsis">致谢</span>
    </a>
  </li>

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../index.html" title="数据库实用入门  documentation" class="md-nav__button md-logo" aria-label="数据库实用入门  documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>
    </a>
    数据库实用入门  documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/hellowac/practical_db_textbook-zh-cn/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    practical_db_textbook-zh-cn
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../../front-matter/preface.html" class="md-nav__link">
        <span class="md-ellipsis">前言</span>
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../index.html"><span class="md-ellipsis">SQL</span></a>
          
            <label for="__nav_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="SQL" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          <span class="md-ellipsis">SQL</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../01-sql-basics/sql-basics.html" class="md-nav__link">
        <span class="md-ellipsis">基础</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../02-data-retrieval/data-retrieval.html" class="md-nav__link">
        <span class="md-ellipsis">数据检索</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../03-expressions/expressions.html" class="md-nav__link">
        <span class="md-ellipsis">表达式</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../04-multiple-tables/multiple-tables.html" class="md-nav__link">
        <span class="md-ellipsis">多个表上的查询</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../05-data-modification/data-modification.html" class="md-nav__link">
        <span class="md-ellipsis">修改数据</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../06-table-creation/table-creation.html" class="md-nav__link">
        <span class="md-ellipsis">数据类型和创建表</span>
      </a>
    </li>
  

            
          
            
              
  
  
    
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          <span class="md-ellipsis">键和约束</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="#" class="md-nav__link md-nav__link--active">
        <span class="md-ellipsis">键和约束</span>
      </a>
      
        

  

<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      <span class="md-ellipsis">键和约束</span>
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#id2" class="md-nav__link">
    <span class="md-ellipsis">本章中使用的表</span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#index-0" class="md-nav__link">
    <span class="md-ellipsis">约束</span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#index-1" class="md-nav__link">
    <span class="md-ellipsis">主键</span>
  </a>
  
    <nav class="md-nav" aria-label="主键">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#index-2" class="md-nav__link">
    <span class="md-ellipsis">创建主键</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#index-3" class="md-nav__link">
    <span class="md-ellipsis">外键</span>
  </a>
  
    <nav class="md-nav" aria-label="外键">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#index-4" class="md-nav__link">
    <span class="md-ellipsis">创建外键约束</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#index-5" class="md-nav__link">
    <span class="md-ellipsis">执行机制</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#id13" class="md-nav__link">
    <span class="md-ellipsis">其他约束</span>
  </a>
  
    <nav class="md-nav" aria-label="其他约束">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#unique" class="md-nav__link">
    <span class="md-ellipsis">UNIQUE</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#not-null" class="md-nav__link">
    <span class="md-ellipsis">NOT NULL</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check" class="md-nav__link">
    <span class="md-ellipsis">CHECK</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../08-subqueries/subqueries.html" class="md-nav__link">
        <span class="md-ellipsis">子查询</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../09-grouping-and-aggregation/grouping-and-aggregation.html" class="md-nav__link">
        <span class="md-ellipsis">分组和聚合</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../10-set-operations/set-operations.html" class="md-nav__link">
        <span class="md-ellipsis">集合运算</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../11-advanced-topics/advanced-topics.html" class="md-nav__link">
        <span class="md-ellipsis">高级主题</span>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../../PART2_DATA_MODELING/index.html" class="md-nav__link">
        <span class="md-ellipsis">数据模型</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../../PART3_RELATIONAL_DATABASE_THEORY/index.html" class="md-nav__link">
        <span class="md-ellipsis">关系数据库理论</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../../references/references.html" class="md-nav__link">
        <span class="md-ellipsis">引用</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../../appendix-a-datasets/datasets.html" class="md-nav__link">
        <span class="md-ellipsis">Appendix A:<wbr> 本书使用的示例数据集</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../../appendix-b-reference/reference.html" class="md-nav__link">
        <span class="md-ellipsis">Appendix B:<wbr> SQL 参考</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../../front-matter/acknowledgments.html" class="md-nav__link">
        <span class="md-ellipsis">致谢</span>
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  

<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      <span class="md-ellipsis">键和约束</span>
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#id2" class="md-nav__link">
    <span class="md-ellipsis">本章中使用的表</span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#index-0" class="md-nav__link">
    <span class="md-ellipsis">约束</span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#index-1" class="md-nav__link">
    <span class="md-ellipsis">主键</span>
  </a>
  
    <nav class="md-nav" aria-label="主键">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#index-2" class="md-nav__link">
    <span class="md-ellipsis">创建主键</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#index-3" class="md-nav__link">
    <span class="md-ellipsis">外键</span>
  </a>
  
    <nav class="md-nav" aria-label="外键">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#index-4" class="md-nav__link">
    <span class="md-ellipsis">创建外键约束</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#index-5" class="md-nav__link">
    <span class="md-ellipsis">执行机制</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#id13" class="md-nav__link">
    <span class="md-ellipsis">其他约束</span>
  </a>
  
    <nav class="md-nav" aria-label="其他约束">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#unique" class="md-nav__link">
    <span class="md-ellipsis">UNIQUE</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#not-null" class="md-nav__link">
    <span class="md-ellipsis">NOT NULL</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check" class="md-nav__link">
    <span class="md-ellipsis">CHECK</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset" role="main">
                  


  <a href="https://github.com/hellowac/practical_db_textbook-zh-cn/blob/main/docs/PART1_SQL/07-constraints/constraints.rst" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
  </a>

<h1 id="constraints-chapter"><span id="id1"></span><span class="section-number">1.7. </span>键和约束<a class="headerlink" href="#constraints-chapter" title="Link to this heading">¶</a></h1>
<p><strong>Keys and constraints</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2">
<input checked type="radio" id="__tabbed_1_1" name="__tabbed_1"><input type="radio" id="__tabbed_1_2" name="__tabbed_1"><div class="tabbed-labels docutils">
<label class="tabbed-label" for="__tabbed_1_1">
中文</label><label class="tabbed-label" for="__tabbed_1_2">
英文</label></div>
<div class="tabbed-content docutils">
<div class="tabbed-block docutils">
<p>在本章中,我们将探讨约束数据的不同方法,以帮助保持数据的正确性。</p>
</div>
<div class="tabbed-block docutils">
<p>In this chapter, we explore the different ways in which data may be constrained in order to help preserve the correctness of our data.</p>
</div>
</div>
</div><h2 id="id2"><span class="section-number">1.7.1. </span>本章中使用的表<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h2>
<p><strong>Tables used in this chapter</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2">
<input checked type="radio" id="__tabbed_2_1" name="__tabbed_2"><input type="radio" id="__tabbed_2_2" name="__tabbed_2"><div class="tabbed-labels docutils">
<label class="tabbed-label" for="__tabbed_2_1">
中文</label><label class="tabbed-label" for="__tabbed_2_2">
英文</label></div>
<div class="tabbed-content docutils">
<div class="tabbed-block docutils">
<p>本章中的一些示例将使用 <strong>books</strong> 表及相关表(有关这些表的完整描述,请参见 <a class="reference internal" href="../../appendix-a-datasets/datasets.html#appendix-a"><span class="std std-ref">Appendix A</span></a>)。其他示例将使用仅为示例创建的表,然后丢弃。</p>
</div>
<div class="tabbed-block docutils">
<p>Some examples in this chapter will use the <strong>books</strong> table and related tables (see <a class="reference internal" href="../../appendix-a-datasets/datasets.html#appendix-a"><span class="std std-ref">Appendix A</span></a> for a full description of these tables).  Other examples will use tables created just for the example, then discarded.</p>
</div>
</div>
</div><h2 id="index-0"><span id="id3"></span><span class="section-number">1.7.2. </span>约束<a class="headerlink" href="#index-0" title="Link to this heading">¶</a></h2>
<p><strong>Constraints</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2">
<input checked type="radio" id="__tabbed_3_1" name="__tabbed_3"><input type="radio" id="__tabbed_3_2" name="__tabbed_3"><div class="tabbed-labels docutils">
<label class="tabbed-label" for="__tabbed_3_1">
中文</label><label class="tabbed-label" for="__tabbed_3_2">
英文</label></div>
<div class="tabbed-content docutils">
<div class="tabbed-block docutils">
<p>由于数据对许多组织和应用程序至关重要,因此值得尽一切努力确保数据库中数据的正确性和一致性。这可以通过多种方式实现：应用软件可以进行检查,以确保数据的输入和维护正确,单独的程序可以测试和报告数据一致性,数据库可以通过约束和触发器来强制执行正确性。(触发器是在某些事件发生时(例如,对行的更新)数据库可以执行的操作;在某些数据库中,操作甚至可以是使用特定实现的编程语言编写的小程序。本书不涵盖触发器。)我们在本章中专注于数据库约束。</p>
<p>约束是限制数据库中数据的各种属性。最简单的约束类型之一是*域*约束：输入到列中的数据被限制为该列定义的类型。(在 SQLite 中不强制执行域约束,因此我们无法使用本书的数据库进行演示。)下面我们讨论强制整个表的数据属性的约束——主键和外键约束——以及适用于单个行的约束：非空、唯一性和检查约束。</p>
</div>
<div class="tabbed-block docutils">
<p>As data is critical to so many organizations and applications, it is worth doing everything possible to ensure the correctness and consistency of the data in databases.  This can be achieved in many ways: application software can do checks to ensure data is entered and maintained correctly, separate programs can test and report on data consistency, and databases can enforce correctness using constraints and triggers.  (Triggers are actions the database can perform when certain events, such as an update to a row, occur; in some databases, the actions can even be complete small programs using implementation-specific programming languages.  This book does not cover triggers.)  We focus in this chapter on database constraints.</p>
<p>Constraints are properties of the database that restrict data in various ways.  One of the simplest types of constraints are <em>domain</em> constraints: data entered into a column is constrained to be of the type defined for the column.  (Domain constraints are not enforced in SQLite, so we cannot demonstrate using the book’s database.)  Below we discuss constraints that enforce data properties for entire tables - primary and foreign key constraints - and those that apply to individual rows: not null, uniqueness, and check constraints.</p>
</div>
</div>
</div><h2 id="index-1"><span id="id4"></span><span class="section-number">1.7.3. </span>主键<a class="headerlink" href="#index-1" title="Link to this heading">¶</a></h2>
<p><strong>Primary keys</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:2">
<input checked type="radio" id="__tabbed_4_1" name="__tabbed_4"><input type="radio" id="__tabbed_4_2" name="__tabbed_4"><div class="tabbed-labels docutils">
<label class="tabbed-label" for="__tabbed_4_1">
中文</label><label class="tabbed-label" for="__tabbed_4_2">
英文</label></div>
<div class="tabbed-content docutils">
<div class="tabbed-block docutils">
<p><a href="#id5"><span class="problematic" id="id6">*</span></a>主键*是表中一列或多列,要求每行存储的值必须是唯一的。控制唯一性确保我们能够通过在另一个表中存储键值,将特定的单个数据项与另一个表中的数据关联起来。它还防止了不必要的数据重复,这可能导致错误的统计(例如,在进行计数或求和时)。在 <a class="reference internal" href="../04-multiple-tables/multiple-tables.html#joins-chapter"><span class="std std-numref">Chapter 1.4</span></a> 中讨论的 id 列——专门用于确保每行可以唯一标识的特殊列——通常用作主键。一个表只能有一个主键。</p>
<p>我们在书籍数据库中可以找到一些例子。例如,表 <strong>authors</strong> 将 <strong>author_id</strong> 作为主键。数据库将通过防止任何会导致主键重复的数据修改查询来强制执行 <strong>author_id</strong> 列的唯一性属性。删除行永远不会违反主键约束,但插入和更新可能会。以下任一查询都会导致错误,因为数据库中已经存在 <strong>author_id</strong> = 1 的行：</p>
<p>download: <a class="reference external" href="/_static/textbook.sqlite3">sqlite3 file</a></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="n">constraints_example_primary_key</span>

<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">authors</span><span class="w"> </span><span class="p">(</span><span class="n">author_id</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">)</span>
<span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Charles Dickens&#39;</span><span class="p">);</span>

<span class="k">UPDATE</span><span class="w"> </span><span class="n">authors</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
</code></pre></div>
</div>
<p>由于我们需要比较主键值以确保唯一性,因此禁止在主键列中插入 <code class="docutils literal notranslate"><span class="pre">NULL</span></code> 值。(然而,SQLite 在这方面的行为有所不同。如果在整数主键列中插入 <code class="docutils literal notranslate"><span class="pre">NULL</span></code>,SQLite 会为你生成一个唯一值。对于其他类型的主键列或多列主键,SQLite 允许插入 <code class="docutils literal notranslate"><span class="pre">NULL</span></code> 值。)</p>
<p>在表 <strong>authors_awards</strong> 中可以找到多列主键的例子。对于此表,主键是(<strong>author_id</strong>,**award_id**)这对值。这并不意味着每一列都是主键,例如,每一列都是独立唯一的。相反,必须是这对值唯一。也就是说,你不能两次插入配对 <code class="docutils literal notranslate"><span class="pre">(4,</span> <span class="pre">10)</span></code>,但可以插入所有的 <code class="docutils literal notranslate"><span class="pre">(4,</span> <span class="pre">10)</span></code>, <code class="docutils literal notranslate"><span class="pre">(4,</span> <span class="pre">11)</span></code>, 和 <a href="#id7"><span class="problematic" id="id8">``</span></a>(5, 10)``(假设这些配对在表中还不存在)。</p>
</div>
<div class="tabbed-block docutils">
<p>A <em>primary key</em> is a column or set of columns of a table which are required to contain unique values for each row stored in the table.  Controlling for uniqueness ensures that we can associate a specific, single item of data with data in another table by storing the key value in the other table. It also prevents unnecessary duplication of data that could result in incorrect statistics (for example, when taking counts or sums).  The id columns discussed in <a class="reference internal" href="../04-multiple-tables/multiple-tables.html#joins-chapter"><span class="std std-numref">Chapter 1.4</span></a> - special columns used specifically to ensure each row can be uniquely identified - are commonly used as primary keys.  A table can have only one primary key.</p>
<p>Some examples can be found in our books database.  The table <strong>authors</strong>, for example, has <strong>author_id</strong> as a primary key.  The database will enforce the uniqueness property of the <strong>author_id</strong> column by preventing any data modification queries which would result in a duplicate primary key.  Deleting rows can never violate a primary key constraint, but inserts and updates can.  Either of the following queries will result in an error because there already exists a row in the database with <strong>author_id</strong> = 1:</p>
<p>download: <a class="reference external" href="/_static/textbook.sqlite3">sqlite3 file</a></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="n">constraints_example_primary_key</span>

<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">authors</span><span class="w"> </span><span class="p">(</span><span class="n">author_id</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">)</span>
<span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Charles Dickens&#39;</span><span class="p">);</span>

<span class="k">UPDATE</span><span class="w"> </span><span class="n">authors</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
</code></pre></div>
</div>
<p>Because we need to compare primary key values to ensure uniqueness, it is also forbidden to insert <code class="docutils literal notranslate"><span class="pre">NULL</span></code> values into a primary key column.  (SQLite varies from this standard behavior, though. If you insert a <code class="docutils literal notranslate"><span class="pre">NULL</span></code> into an integer primary key column, SQLite will generate a unique value for you.  For other primary key column types, or multi-column primary keys, <code class="docutils literal notranslate"><span class="pre">NULL</span></code> values are permitted in SQLite.)</p>
<p>An example of a multi-column primary key can be found in the table <strong>authors_awards</strong>.  For this table, the primary key is the pair (<strong>author_id</strong>, <strong>award_id</strong>).  This does not mean that each column is a primary key, e.g., that each column is independently unique.  Instead, it is the pair of values which must be unique.  That is, you may not insert the pair <code class="docutils literal notranslate"><span class="pre">(4,</span> <span class="pre">10)</span></code> twice, but you may insert all of <code class="docutils literal notranslate"><span class="pre">(4,</span> <span class="pre">10)</span></code>, <code class="docutils literal notranslate"><span class="pre">(4,</span> <span class="pre">11)</span></code>, and <code class="docutils literal notranslate"><span class="pre">(5,</span> <span class="pre">10)</span></code> (assuming none of those pairs is already in the table).</p>
</div>
</div>
</div><h3 id="index-2"><span id="id9"></span><span class="section-number">1.7.3.1. </span>创建主键<a class="headerlink" href="#index-2" title="Link to this heading">¶</a></h3>
<p><strong>Creating a primary key</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="5:2">
<input checked type="radio" id="__tabbed_5_1" name="__tabbed_5"><input type="radio" id="__tabbed_5_2" name="__tabbed_5"><div class="tabbed-labels docutils">
<label class="tabbed-label" for="__tabbed_5_1">
中文</label><label class="tabbed-label" for="__tabbed_5_2">
英文</label></div>
<div class="tabbed-content docutils">
<div class="tabbed-block docutils">
<p>在表上创建主键有几种方法。创建表时创建主键是最简单的。如果主键是单列,则可以简单地将 <strong>PRIMARY KEY</strong> 短语放在列定义的末尾：</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">test</span><span class="p">;</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span>
<span class="p">);</span>
</code></pre></div>
</div>
<p>你也可以将主键作为表定义中的单独条目创建;在创建多列主键时,必须使用这种形式。下面的第一个定义与上面的定义等价,而第二个定义则创建了一个多列主键：</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">test2</span><span class="p">;</span>
<span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">test3</span><span class="p">;</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">test2</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
<span class="w">  </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">test3</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span>
<span class="w">  </span><span class="n">y</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span>
<span class="w">  </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>
</div>
<p>某些数据库系统还允许使用 <strong>ALTER TABLE</strong> 命令将主键添加到现有表,只要现有数据符合该约束。<strong>ALTER TABLE</strong> 也可用于从表中移除(删除)约束。(SQLite 不支持此用法。)</p>
</div>
<div class="tabbed-block docutils">
<p>There are a few ways to create a primary key on a table.  It is easiest to create a primary key when creating the table.  If the primary key is a single column, then you may simply put the phrase <strong>PRIMARY KEY</strong> at the end of the column definition:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">test</span><span class="p">;</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span>
<span class="p">);</span>
</code></pre></div>
</div>
<p>You can also create the primary key as a separate entry in the table definition; you must use this form when creating a multi-column primary key.  The first definition below is equivalent to the one above, while the second creates a multi-column primary key:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">test2</span><span class="p">;</span>
<span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">test3</span><span class="p">;</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">test2</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
<span class="w">  </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">test3</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span>
<span class="w">  </span><span class="n">y</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span>
<span class="w">  </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>
</div>
<p>Some database systems also allow the addition of a primary key to an existing table using the <strong>ALTER TABLE</strong> command, as long as the existing data would conform to the constraint.  <strong>ALTER TABLE</strong> can also be used to remove (drop) constraints from a table.  (SQLite does not support this usage.)</p>
</div>
</div>
</div><h2 id="index-3"><span id="id10"></span><span class="section-number">1.7.4. </span>外键<a class="headerlink" href="#index-3" title="Link to this heading">¶</a></h2>
<p><strong>Foreign keys</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="6:2">
<input checked type="radio" id="__tabbed_6_1" name="__tabbed_6"><input type="radio" id="__tabbed_6_2" name="__tabbed_6"><div class="tabbed-labels docutils">
<label class="tabbed-label" for="__tabbed_6_1">
中文</label><label class="tabbed-label" for="__tabbed_6_2">
英文</label></div>
<div class="tabbed-content docutils">
<div class="tabbed-block docutils">
<p>我们还对不同表之间的数据关系感兴趣。例如,**books** 表中的每一行都有一个 <strong>author_id</strong> 值,这让我们可以在 <strong>authors</strong> 表中查找作者信息。我们如何确保 <strong>author_id</strong> 值是有效的,即它始终有对应的 <strong>authors</strong> 表中的行呢？对于关系数据库,解决方案是 <em>外键</em> 约束。</p>
<p>外键约束适用于一个表中的列或列列表(<em>引用</em> 表),并引用另一个表中的列或列列表(<em>被引用</em> 表)。该约束要求以下两种情况之一为真：</p>
<ul class="simple">
<li><p>引用表中的列或列列表中的值存在于被引用的列或列列表中</p></li>
<li><p>引用表中的列或列列表中的值为 <code class="docutils literal notranslate"><span class="pre">NULL</span></code></p></li>
</ul>
<p>被引用表中的列或列列表必须约束为唯一,通常通过将它们设为主键,或通过唯一性约束(见下文)。</p>
<p>我们的数据库在 <strong>books</strong> 和 <strong>authors</strong> 之间定义了一个外键。外键约束位于 <strong>books</strong> 的 <strong>author_id</strong> 列上,引用 <strong>authors</strong> 的 <strong>author_id</strong> 列。如果我们想要向 <strong>books</strong> 中添加一本新书,我们必须使用一个 <strong>author_id</strong> 值,这个值必须是 <strong>authors</strong> 表中的有效 <strong>author_id</strong>。外键本身允许 <code class="docutils literal notranslate"><span class="pre">NULL</span></code> 的 <strong>author_id</strong> 值,但我们进一步约束了 <strong>author_id</strong> 列,使其不能为 null(使用稍后定义的 <strong>NOT NULL</strong> 约束)。</p>
<p>例如,下面的代码将因 <strong>books</strong> 中的外键约束引用 <strong>authors</strong> 而失败。(注意,与其他数据库系统不同,SQLite 不会强制执行外键,除非你特别告诉它这样做——下面以 <strong>PRAGMA</strong> 关键字开头的代码就是在执行这个操作。<strong>PRAGMA</strong> 关键字不是 SQL 标准的一部分,仅在 SQLite 中需要。)</p>
<p>download: <a class="reference external" href="/_static/textbook.sqlite3">sqlite3 file</a></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="n">constraints_example_foreign_key</span>

<span class="n">PRAGMA</span><span class="w"> </span><span class="n">foreign_keys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">ON</span><span class="p">;</span>

<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="p">(</span><span class="n">author_id</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="p">)</span>
<span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Unknown&#39;</span><span class="p">);</span><span class="w">   </span><span class="c1">-- 99 不是有效的作者 ID</span>
</code></pre></div>
</div>
<p>我们同样不能进行会破坏现有关系的操作。例如,**books** 表中存在 <strong>author_id</strong> = 1 的记录。如果我们删除具有该 ID 值的作者,将违反 <strong>books</strong> 表上的外键约束。我们也会违反 <strong>authors_awards</strong> 上的类似外键约束。因此,这段代码会产生错误：</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="n">PRAGMA</span><span class="w"> </span><span class="n">foreign_keys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">ON</span><span class="p">;</span>

<span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">authors</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</code></pre></div>
</div>
<p>然而,如果我们首先删除该作者的所有书籍和奖项,就可以成功删除该作者：</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="n">PRAGMA</span><span class="w"> </span><span class="n">foreign_keys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">ON</span><span class="p">;</span>

<span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">authors_awards</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">authors</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</code></pre></div>
</div>
<p>我们同样不能在不先删除任何引用表的情况下删除 <strong>authors</strong> 表。</p>
<p><strong>books</strong> 和 <strong>authors</strong> 的示例展示了一个常见模式,即外键约束将我们可能希望在联接查询中使用的列联系起来(见 <a class="reference internal" href="../04-multiple-tables/multiple-tables.html#joins-chapter"><span class="std std-numref">Chapter 1.4</span></a>)。这并不意味着外键是联接的必要条件;关系数据库的一大优势是数据之间的关系不必是预先确定的。然而,外键的存在表明引用表和被引用表中的数据之间存在自然关系。</p>
<p>外键约束也被称为 <em>参照完整性约束</em>。</p>
</div>
<div class="tabbed-block docutils">
<p>We are also interested in the relationships between data in different tables.  For example, every row in the <strong>books</strong> table has an <strong>author_id</strong> value which lets us look up author information in the <strong>authors</strong> table.  How can we ensure that the <strong>author_id</strong> value is valid, that is, that it always has a corresponding row in the <strong>authors</strong> table?  For a relational database, the solution is a <em>foreign key</em> constraint.</p>
<p>A foreign key constraint applies to a column or list of columns in one table (the <em>referencing</em> table), and references a column or list of columns in another table (the <em>referenced</em> table).  The constraint requires that one of two things be true:</p>
<ul class="simple">
<li><p>The values in the column or columns in the referencing table exist in the referenced column or columns</p></li>
<li><p>The values in the column or columns in the referencing table are <code class="docutils literal notranslate"><span class="pre">NULL</span></code></p></li>
</ul>
<p>The column or columns in the referenced table must be constrained to be unique, either by making them the primary key (the usual case), or through a uniqueness constraint (see below).</p>
<p>Our database defines a foreign key between <strong>books</strong> and <strong>authors</strong>.  The foreign key constraint is on the <strong>author_id</strong> column of <strong>books</strong> and references the <strong>author_id</strong> column of <strong>authors</strong>.  If we want to add a new book to <strong>books</strong>, we must add it with an <strong>author_id</strong> value, which must be a valid <strong>author_id</strong> from the <strong>authors</strong> table.  The foreign key by itself would allow a <code class="docutils literal notranslate"><span class="pre">NULL</span></code> <strong>author_id</strong> value, but we have further constrained the <strong>author_id</strong> column to not be null (using the <strong>NOT NULL</strong> constraint defined later on).</p>
<p>For example, the code below will fail due to the foreign key constraint on <strong>books</strong> referencing <strong>authors</strong>.  (Note that, unlike other database systems, SQLite will not enforce foreign keys unless you specifically tell it to - that is what the line of code below starting with the keyword <strong>PRAGMA</strong> is doing.  The <strong>PRAGMA</strong> keyword is not part of the SQL standard, and is only needed in SQLite.)</p>
<p>download: <a class="reference external" href="/_static/textbook.sqlite3">sqlite3 file</a></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="n">constraints_example_foreign_key</span>

<span class="n">PRAGMA</span><span class="w"> </span><span class="n">foreign_keys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">ON</span><span class="p">;</span>

<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="p">(</span><span class="n">author_id</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="p">)</span>
<span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Unknown&#39;</span><span class="p">);</span><span class="w">   </span><span class="c1">-- 99 is not a valid author id</span>
</code></pre></div>
</div>
<p>We also cannot do operations which would destroy existing relationships.  For example, there exist records in the <strong>books</strong> table for which the <strong>author_id</strong> = 1.  If we were to delete the author with this id value, we would violate the foreign key constraint on the <strong>books</strong> table.  We would also violate a similar foreign key constraint on <strong>authors_awards</strong>.  This code therefore produces an error:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="n">PRAGMA</span><span class="w"> </span><span class="n">foreign_keys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">ON</span><span class="p">;</span>

<span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">authors</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</code></pre></div>
</div>
<p>However, if we first remove all books and awards for this author, we can successfully remove the author:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="n">PRAGMA</span><span class="w"> </span><span class="n">foreign_keys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">ON</span><span class="p">;</span>

<span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">authors_awards</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">authors</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</code></pre></div>
</div>
<p>We similarly cannot drop the <strong>authors</strong> table without first dropping any referencing tables.</p>
<p>The <strong>books</strong> and <strong>authors</strong> examples demonstrate a common pattern, which is that foreign key constraints relate columns that we are likely to want to use in a join query (<a class="reference internal" href="../04-multiple-tables/multiple-tables.html#joins-chapter"><span class="std std-numref">Chapter 1.4</span></a>).  This does not mean that a foreign key is a necessary condition for a join; one of the strengths of a relational database is that relationships between data do not have to be predetermined.  However, the presence of a foreign key is an indication that there exists a natural relationship between the data in the referencing and referenced tables.</p>
<p>Foreign key constraints are also known as <em>referential integrity constraints</em>.</p>
</div>
</div>
</div><h3 id="index-4"><span id="id11"></span><span class="section-number">1.7.4.1. </span>创建外键约束<a class="headerlink" href="#index-4" title="Link to this heading">¶</a></h3>
<p><strong>Creating a foreign key constraint</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="7:2">
<input checked type="radio" id="__tabbed_7_1" name="__tabbed_7"><input type="radio" id="__tabbed_7_2" name="__tabbed_7"><div class="tabbed-labels docutils">
<label class="tabbed-label" for="__tabbed_7_1">
中文</label><label class="tabbed-label" for="__tabbed_7_2">
英文</label></div>
<div class="tabbed-content docutils">
<div class="tabbed-block docutils">
<p>与主键一样,创建外键约束的方法有多种。如果外键约束限制了单个列,则可以在表的列定义中使用 <strong>REFERENCES</strong> 关键字添加它：</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="k">referencing</span><span class="p">;</span>
<span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">referenced</span><span class="p">;</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">referenced</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">referencing</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">xx</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">referenced</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>
</div>
<p>请注意,尽管外键约束只出现在引用表的定义中,但该约束影响两个表。上述代码确保 <strong>referencing</strong> 中的 <strong>xx</strong> 列的值要么是 <code class="docutils literal notranslate"><span class="pre">NULL</span></code>,要么包含在 <strong>referenced</strong> 的 <strong>x</strong> 列中。</p>
<p>(针对 MySQL 用户：MySQL 不识别用于创建外键的单列语法。请改用下面的显式约束语法。)</p>
<p>我们还可以通过在表定义中添加单独的 <strong>FOREIGN KEY</strong> 条目来创建外键约束。这种形式必须用于多列外键：</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">referencing2</span><span class="p">;</span>
<span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">referenced2</span><span class="p">;</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">referenced2</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">a</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
<span class="w">  </span><span class="n">b</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
<span class="w">  </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">referencing2</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="k">c</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">  </span><span class="n">aa</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
<span class="w">  </span><span class="n">bb</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
<span class="w">  </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">aa</span><span class="p">,</span><span class="w"> </span><span class="n">bb</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">referenced2</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>
</div>
<p>在上述示例中,**referencing2** 中的 <em>对</em> (<strong>aa</strong>, <strong>bb</strong>) 必须与 <strong>referenced2</strong> 中的对应 (<strong>a</strong>, <strong>b</strong>) 对匹配;这些列不是独立约束的。</p>
<p>请注意,可以(有时有用)创建一个外键约束,其中引用表和被引用表是同一表。例如,一家公司可能有一个引用自身的员工表：</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">  </span><span class="n">supervisor_id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>
</div>
<p>与主键一样,一些数据库系统允许使用 <strong>ALTER TABLE</strong> 命令添加或删除外键约束。(SQLite 不支持这种用法。)</p>
</div>
<div class="tabbed-block docutils">
<p>As with primary keys, there are multiple ways to create a foreign key constraint.  If the foreign key constrains a single column, then we can add it in the column definition for a table using the <strong>REFERENCES</strong> keyword:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="k">referencing</span><span class="p">;</span>
<span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">referenced</span><span class="p">;</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">referenced</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">referencing</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">xx</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">referenced</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>
</div>
<p>Note that although the foreign key constraint only appears in the referencing table definition, the constraint affects both tables.  The code above ensures that values in the <strong>xx</strong> column of <strong>referencing</strong> are either <code class="docutils literal notranslate"><span class="pre">NULL</span></code> or contained in the <strong>x</strong> column of <strong>referenced</strong>.</p>
<p>(Note for MySQL users: MySQL does not recognize the single column syntax for creating foreign keys.  Use instead the explicit constraint syntax below.)</p>
<p>We can also create a foreign key constraint with a separate <strong>FOREIGN KEY</strong> entry in the table definition.  This form must be used for multi-column foreign keys:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">referencing2</span><span class="p">;</span>
<span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">referenced2</span><span class="p">;</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">referenced2</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">a</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
<span class="w">  </span><span class="n">b</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
<span class="w">  </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">referencing2</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="k">c</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">  </span><span class="n">aa</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
<span class="w">  </span><span class="n">bb</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
<span class="w">  </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">aa</span><span class="p">,</span><span class="w"> </span><span class="n">bb</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">referenced2</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>
</div>
<p>In the above example, the <em>pair</em> (<strong>aa</strong>, <strong>bb</strong>) in <strong>referencing2</strong> must match a corresponding (<strong>a</strong>, <strong>b</strong>) pair in <strong>referenced2</strong>; the columns are not constrained independently.</p>
<p>Note that it is possible (and sometimes useful) to create a foreign key constraint in which the referencing and referenced tables are the same table.  For example, a company might have a table of employees that references itself:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">  </span><span class="n">supervisor_id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>
</div>
<p>As with primary keys, some database systems allow the addition or removal of foreign key constraints using the <strong>ALTER TABLE</strong> command.  (This usage is not supported by SQLite.)</p>
</div>
</div>
</div><h3 id="index-5"><span id="id12"></span><span class="section-number">1.7.4.2. </span>执行机制<a class="headerlink" href="#index-5" title="Link to this heading">¶</a></h3>
<p><strong>Enforcement mechanisms</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="8:2">
<input checked type="radio" id="__tabbed_8_1" name="__tabbed_8"><input type="radio" id="__tabbed_8_2" name="__tabbed_8"><div class="tabbed-labels docutils">
<label class="tabbed-label" for="__tabbed_8_1">
中文</label><label class="tabbed-label" for="__tabbed_8_2">
英文</label></div>
<div class="tabbed-content docutils">
<div class="tabbed-block docutils">
<p>外键约束的默认行为是拒绝任何可能违反该约束的数据修改尝试。然而,SQL 提供了可应用于 <strong>DELETE</strong> 或 <strong>UPDATE</strong> 查询的附加选项。在外键约束中添加短语 <strong>ON DELETE SET NULL</strong> 表示如果引用表的行被删除,则相应的引用键值应设置为 <code class="docutils literal notranslate"><span class="pre">NULL``(如果允许)。短语</span> <span class="pre">**ON</span> <span class="pre">DELETE</span> <span class="pre">CASCADE**</span> <span class="pre">表示引用行应与被引用行一同删除。类似地,**ON</span> <span class="pre">UPDATE</span> <span class="pre">SET</span> <span class="pre">NULL**</span> <span class="pre">在被引用键值更改时将引用键值设置为</span> <span class="pre">``NULL</span></code>;**ON UPDATE CASCADE** 则将引用键值更改为匹配被更改的引用键值。最后,如果您想明确使用默认行为,可以使用 <strong>ON DELETE RESTRICT</strong> 和 <strong>ON UPDATE RESTRICT</strong>。</p>
<p>这里是一个示例,使用 <strong>CASCADE</strong> 处理删除和更新(可以修改以尝试不同设置)：</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="n">PRAGMA</span><span class="w"> </span><span class="n">foreign_keys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">ON</span><span class="p">;</span>

<span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">works</span><span class="p">;</span>
<span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">composers</span><span class="p">;</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">composers</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">composers</span><span class="w"> </span><span class="k">VALUES</span>
<span class="w">  </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Beethoven&#39;</span><span class="p">),</span>
<span class="w">  </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Mozart&#39;</span><span class="p">)</span>
<span class="p">;</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">works</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">title</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
<span class="w">  </span><span class="n">composer_id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">composers</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">CASCADE</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> </span><span class="k">CASCADE</span>
<span class="p">);</span>

<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">works</span><span class="w"> </span><span class="k">VALUES</span>
<span class="w">  </span><span class="p">(</span><span class="s1">&#39;Symphony No. 1&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span>
<span class="w">  </span><span class="p">(</span><span class="s1">&#39;Symphony No. 2&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span>
<span class="w">  </span><span class="p">(</span><span class="s1">&#39;String Quartet No. 1&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="p">;</span>

<span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">composers</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Beethoven&#39;</span><span class="p">;</span>

<span class="k">UPDATE</span><span class="w"> </span><span class="n">composers</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Mozart&#39;</span><span class="p">;</span>

<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">composers</span><span class="p">;</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">works</span><span class="p">;</span>
</code></pre></div>
</div>
</div>
<div class="tabbed-block docutils">
<p>The default behavior for a foreign key constraint is to reject any attempt to modify data in a way that would violate the constraint.  However, SQL provides additional options that can be applied for <strong>DELETE</strong> or <strong>UPDATE</strong> queries.  Adding the phrase <strong>ON DELETE SET NULL</strong> to the foreign key constraint indicates that a deletion of a referenced table row should result in setting corresponding referencing key values to <code class="docutils literal notranslate"><span class="pre">NULL</span></code> (if permitted).  The phrase <strong>ON DELETE CASCADE</strong> indicates that referencing rows should be deleted along with the referenced row.  Similarly, <strong>ON UPDATE SET NULL</strong> results in setting referencing key values to <code class="docutils literal notranslate"><span class="pre">NULL</span></code> if the referenced key value is changed; <strong>ON UPDATE CASCADE</strong> changes the referencing key values to match the changed referenced key value.  Finally, if you want to use the default behavior explicitly, you can use <strong>ON DELETE RESTRICT</strong> and <strong>ON UPDATE RESTRICT</strong>.</p>
<p>Here is an example to try, using <strong>CASCADE</strong> for both deletions and updates (modify to try different settings):</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="n">PRAGMA</span><span class="w"> </span><span class="n">foreign_keys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">ON</span><span class="p">;</span>

<span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">works</span><span class="p">;</span>
<span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">composers</span><span class="p">;</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">composers</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">composers</span><span class="w"> </span><span class="k">VALUES</span>
<span class="w">  </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Beethoven&#39;</span><span class="p">),</span>
<span class="w">  </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Mozart&#39;</span><span class="p">)</span>
<span class="p">;</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">works</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">title</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
<span class="w">  </span><span class="n">composer_id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">composers</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">CASCADE</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> </span><span class="k">CASCADE</span>
<span class="p">);</span>

<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">works</span><span class="w"> </span><span class="k">VALUES</span>
<span class="w">  </span><span class="p">(</span><span class="s1">&#39;Symphony No. 1&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span>
<span class="w">  </span><span class="p">(</span><span class="s1">&#39;Symphony No. 2&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span>
<span class="w">  </span><span class="p">(</span><span class="s1">&#39;String Quartet No. 1&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="p">;</span>

<span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">composers</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Beethoven&#39;</span><span class="p">;</span>

<span class="k">UPDATE</span><span class="w"> </span><span class="n">composers</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Mozart&#39;</span><span class="p">;</span>

<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">composers</span><span class="p">;</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">works</span><span class="p">;</span>
</code></pre></div>
</div>
</div>
</div>
</div><h2 id="id13"><span class="section-number">1.7.5. </span>其他约束<a class="headerlink" href="#id13" title="Link to this heading">¶</a></h2>
<p><strong>Other constraints</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="9:2">
<input checked type="radio" id="__tabbed_9_1" name="__tabbed_9"><input type="radio" id="__tabbed_9_2" name="__tabbed_9"><div class="tabbed-labels docutils">
<label class="tabbed-label" for="__tabbed_9_1">
中文</label><label class="tabbed-label" for="__tabbed_9_2">
英文</label></div>
<div class="tabbed-content docutils">
<div class="tabbed-block docutils">
<p>SQL 提供了一些您可能会觉得有用的附加约束,本节将对此进行描述。</p>
</div>
<div class="tabbed-block docutils">
<p>SQL provides some additional constraints you may find useful, which are described in this section.</p>
</div>
</div>
</div><h3 id="unique"><span id="index-6"></span><span class="section-number">1.7.5.1. </span>UNIQUE<a class="headerlink" href="#unique" title="Link to this heading">¶</a></h3>
<p><strong>UNIQUE</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="10:2">
<input checked type="radio" id="__tabbed_10_1" name="__tabbed_10"><input type="radio" id="__tabbed_10_2" name="__tabbed_10"><div class="tabbed-labels docutils">
<label class="tabbed-label" for="__tabbed_10_1">
中文</label><label class="tabbed-label" for="__tabbed_10_2">
英文</label></div>
<div class="tabbed-content docutils">
<div class="tabbed-block docutils">
<p>偶尔,您可能需要确保某一列或一组列包含唯一值,但您不想将该列或列组设置为主键(例如,当其他某组列已经是主键时)。可以使用 <strong>UNIQUE</strong> 约束来实现此目的;只需在列定义中添加 <strong>UNIQUE</strong> 关键字。<strong>UNIQUE</strong> 约束和主键约束之间的一个区别是,**UNIQUE** 约束不阻止 <code class="docutils literal notranslate"><span class="pre">NULL</span></code> 值。然而,数据库对唯一列中的 <code class="docutils literal notranslate"><span class="pre">NULL</span></code> 值的处理方式不同;一些数据库允许多行包含 <code class="docutils literal notranslate"><span class="pre">NULL</span></code>,而其他数据库则仅允许一行 <code class="docutils literal notranslate"><span class="pre">NULL``(有效地将</span> <span class="pre">``NULL</span></code> 视为可比较值)。请注意,下面的最后一条语句将因违反列 <strong>x</strong> 上的 <strong>UNIQUE</strong> 约束而失败。</p>
<p>download: <a class="reference external" href="/_static/textbook.sqlite3">sqlite3 file</a></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="n">constraints_example_other</span>

<span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">test4</span><span class="p">;</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">test4</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">UNIQUE</span>
<span class="p">);</span>

<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">test4</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">test4</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">test4</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</code></pre></div>
</div>
<p>您还可以将 <strong>UNIQUE</strong> 约束作为表定义中的单独条目创建(对于多列约束这是必需的)：</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">test5</span><span class="p">;</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">test5</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span>
<span class="w">  </span><span class="n">y</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span>
<span class="w">  </span><span class="k">UNIQUE</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>
</div>
<p>请注意,针对一组列的主键约束已经隐含了比 <strong>UNIQUE</strong> 更强的含义,因此如果 <strong>PRIMARY KEY</strong> 已经存在,则无需指定 <strong>UNIQUE</strong>。</p>
</div>
<div class="tabbed-block docutils">
<p>Occasionally you may need to ensure that a column or set of columns contains unique values, but you do not want to set the column or columns as a primary key (for example, when some other set of columns is already the primary key).  The <strong>UNIQUE</strong> constraint can be used for this purpose; simply add the <strong>UNIQUE</strong> keyword as part of the column definition.  One difference between a <strong>UNIQUE</strong> constraint and a primary key constraint is that the <strong>UNIQUE</strong> constraint does not prevent <code class="docutils literal notranslate"><span class="pre">NULL</span></code> values. However, databases deal with <code class="docutils literal notranslate"><span class="pre">NULL</span></code> values in a unique column in different ways; some allow multiple rows to contain <code class="docutils literal notranslate"><span class="pre">NULL</span></code>, and others allow only a single <code class="docutils literal notranslate"><span class="pre">NULL</span></code> row (effectively treating <code class="docutils literal notranslate"><span class="pre">NULL</span></code> as a comparable value).  Note that the final statement below will fail due to a violation of the <strong>UNIQUE</strong> constraint on column <strong>x</strong>.</p>
<p>download: <a class="reference external" href="/_static/textbook.sqlite3">sqlite3 file</a></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="n">constraints_example_other</span>

<span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">test4</span><span class="p">;</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">test4</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">UNIQUE</span>
<span class="p">);</span>

<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">test4</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">test4</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">test4</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</code></pre></div>
</div>
<p>You can also create a <strong>UNIQUE</strong> constraint as a separate entry in the table definition (this is required for a multi-column constraint):</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">test5</span><span class="p">;</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">test5</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span>
<span class="w">  </span><span class="n">y</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span>
<span class="w">  </span><span class="k">UNIQUE</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>
</div>
<p>Note that a primary key constraint on a set of columns already implies something stronger than <strong>UNIQUE</strong>, thus there is no need to specify <strong>UNIQUE</strong> if <strong>PRIMARY KEY</strong> is already in place.</p>
</div>
</div>
</div><h3 id="not-null"><span id="index-7"></span><span class="section-number">1.7.5.2. </span>NOT NULL<a class="headerlink" href="#not-null" title="Link to this heading">¶</a></h3>
<p><strong>NOT NULL</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="11:2">
<input checked type="radio" id="__tabbed_11_1" name="__tabbed_11"><input type="radio" id="__tabbed_11_2" name="__tabbed_11"><div class="tabbed-labels docutils">
<label class="tabbed-label" for="__tabbed_11_1">
中文</label><label class="tabbed-label" for="__tabbed_11_2">
英文</label></div>
<div class="tabbed-content docutils">
<div class="tabbed-block docutils">
<p><code class="docutils literal notranslate"><span class="pre">NULL</span></code> 值可能是许多数据错误的源头。如果您的软件中的某个错误错误地将 <code class="docutils literal notranslate"><span class="pre">NULL</span></code> 值插入数据库,数据将变得不完整,对数据的查询可能会产生错误的结果。此外,由于 <code class="docutils literal notranslate"><span class="pre">NULL</span></code> 值不可比较,因此在查询时它们往往是“不可见”的,除非专门使用 <strong>IS NULL</strong> 进行查找。这些因素的结合可能导致您花费大量时间来解决您认为真实的内容与查询结果之间的差异。</p>
<p>因此,使用 <strong>NOT NULL</strong> 约束限制列不允许 <code class="docutils literal notranslate"><span class="pre">NULL</span></code> 值是非常有价值的。在我们的数据库中,一个例子是 <strong>authors</strong> 表,其中 <strong>name</strong> 列有一个 <strong>NOT NULL</strong> 约束——我们始终希望 <strong>name</strong> 列中有一个值 <a class="footnote-reference brackets" href="#id16" id="id14" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> . 您可以在与书籍相关的其他表中找到其他示例。</p>
<p>请注意,主键中的所有列隐含地具有 <strong>NOT NULL</strong>,因此不需要为这些列指定 <strong>NOT NULL</strong>。</p>
</div>
<div class="tabbed-block docutils">
<p><code class="docutils literal notranslate"><span class="pre">NULL</span></code> values can be a source of many data errors.  If some bug in your software incorrectly inserts <code class="docutils literal notranslate"><span class="pre">NULL</span></code> values into your database, the data becomes corrupt, and queries against the data may produce wrong answers. Also, since <code class="docutils literal notranslate"><span class="pre">NULL</span></code> values are not comparable, they tend to be “invisible” when querying, unless looked for specifically using <strong>IS NULL</strong>.   This combination of factors can result in many lost hours of work trying to resolve differences between what you believe is true and what your queries are telling you.</p>
<p>It can be valuable, then, to constrain columns to not allow <code class="docutils literal notranslate"><span class="pre">NULL</span></code> values at all, using the <strong>NOT NULL</strong> constraint.  In our database, one example is the <strong>authors</strong> table, which has a <strong>NOT NULL</strong> constraint on the <strong>name</strong> column - we always want a value in the <strong>name</strong> column <a class="footnote-reference brackets" href="#id17" id="id15" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>.  You can find other examples in the books-related tables.</p>
<p>Note that <strong>NOT NULL</strong> is implied on all columns in a primary key, so there is no need to specify <strong>NOT NULL</strong> for those columns.</p>
</div>
</div>
</div><h3 id="check"><span id="index-8"></span><span class="section-number">1.7.5.3. </span>CHECK<a class="headerlink" href="#check" title="Link to this heading">¶</a></h3>
<p><strong>CHECK</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="12:2">
<input checked type="radio" id="__tabbed_12_1" name="__tabbed_12"><input type="radio" id="__tabbed_12_2" name="__tabbed_12"><div class="tabbed-labels docutils">
<label class="tabbed-label" for="__tabbed_12_1">
中文</label><label class="tabbed-label" for="__tabbed_12_2">
英文</label></div>
<div class="tabbed-content docutils">
<div class="tabbed-block docutils">
<p>SQL 提供了一种通用的约束形式,您可以用来对数据应用简单的布尔条件。<strong>CHECK</strong> 约束可以是涉及表中单个列或多个列的表达式。这个表达式通常在其他方面的使用上有限制;例如,通常不允许子查询,并且某些数据库不允许调用函数(实现因数据库而异)。</p>
<p>下面是一个示例,展示了单列和表约束形式：</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">test6</span><span class="p">;</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">test6</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">a</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">CHECK</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="mi">100</span><span class="p">),</span>
<span class="w">  </span><span class="n">b</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span>
<span class="w">  </span><span class="k">CHECK</span><span class="w"> </span><span class="p">(</span><span class="n">b</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">test6</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">42</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">test6</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">);</span><span class="w">   </span><span class="c1">-- 错误</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">test6</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span><span class="w">   </span><span class="c1">-- 错误</span>
</code></pre></div>
</div>
</div>
<div class="tabbed-block docutils">
<p>SQL provides a general constraint form that you can use to apply simple Boolean conditions on your data.  The <strong>CHECK</strong> constraint can be an expression involving a single column or multiple columns of the table.  This expression is typically limited in what else it can incorporate; for example subqueries are typically not allowed, and some databases do not allow function calls (implementations vary).</p>
<p>Here is an example, showing both single column and table constraint forms:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><code><span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">test6</span><span class="p">;</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">test6</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">a</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">CHECK</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="mi">100</span><span class="p">),</span>
<span class="w">  </span><span class="n">b</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span>
<span class="w">  </span><span class="k">CHECK</span><span class="w"> </span><span class="p">(</span><span class="n">b</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">test6</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">42</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">test6</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">);</span><span class="w">   </span><span class="c1">-- error</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">test6</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span><span class="w">   </span><span class="c1">-- error</span>
</code></pre></div>
</div>
</div>
</div>
</div><hr class="docutils" />
<p><strong>Notes</strong></p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id16" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id14">1</a><span class="fn-bracket">]</span></span>
<p>我们可能希望记录一些作者未知(或匿名)的书籍,这似乎是一个想要使用 <code class="docutils literal notranslate"><span class="pre">NULL</span></code> 的实例;毕竟,``NULL`` 的一个可能含义是“未知”。然而,未知作者在 <strong>authors</strong> 表中有条目意味着什么？如果有的话,我们该如何解释 <code class="docutils literal notranslate"><span class="pre">NULL</span></code> 作者的出生和死亡日期字段？如果与该作者记录相关的多本书籍又意味着什么？它们都是同一个未知作者的作品,还是不同作者的作品,而这些作者都是未知的？对于没有已知作者的书籍,允许 <strong>books</strong> 表中 <strong>author_id</strong> 列的 <code class="docutils literal notranslate"><span class="pre">NULL</span></code> 值可能是一个稍好的选择——这更接近所需的含义。然而,这也引入了自身的问题,例如 <strong>books</strong> 和 <strong>authors</strong> 的内连接将会排除任何未知作者的书籍,因此我们在编写查询时需要非常小心。所有这些并不是说 <code class="docutils literal notranslate"><span class="pre">NULL</span></code> 从来不是正确的选择,而是它引入了复杂性,因此更有可能导致软件错误和数据损坏。请仔细考虑您的选择。</p>
</aside>
<aside class="footnote brackets" id="id17" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id15">2</a><span class="fn-bracket">]</span></span>
<p>It is possible that we might wish to record some book for whom the author is unknown (or anonymous), which might seem like an instance in which we would want <code class="docutils literal notranslate"><span class="pre">NULL</span></code>; after all, one possible meaning of <code class="docutils literal notranslate"><span class="pre">NULL</span></code> is “unknown”.  However, what does it mean for an unknown author to have an entry in the <strong>authors</strong> table in the first place?   What meaning would we give, if any, to the birth and death date fields for the <code class="docutils literal notranslate"><span class="pre">NULL</span></code> author?  And what does it mean if multiple books relate to that author record?  Are they all by the same, unknown author, or by different authors, all of whom are unknown?  A slightly better choice for a book with no known author may be to allow <code class="docutils literal notranslate"><span class="pre">NULL</span></code> values in the <strong>author_id</strong> column in <strong>books</strong> - this is closer to the desired meaning.  However, this introduces problems of its own, such as the fact that an inner join of <strong>books</strong> and <strong>authors</strong> will now leave out any books with unknown authors, so we would need to be very careful in writing our queries.  None of this is to say that <code class="docutils literal notranslate"><span class="pre">NULL</span></code> is never the right choice, only that it introduces complexity and therefore more opportunity for software bugs and data corruption.  Consider your options carefully.</p>
</aside>
</aside>






                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../06-table-creation/table-creation.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: 1.6. 数据类型和创建表" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              1.6. 数据类型和创建表
            </div>
          </div>
        </a>
      
      
        
        <a href="../08-subqueries/subqueries.html" class="md-footer__link md-footer__link--next" aria-label="Next: 1.8. 子查询" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              1.8. 子查询
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  
  
  <div class="md-footer-meta md-typeset">
    
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-footer-copyright__highlight">
        &#169; Copyright 2024, Christopher Painter&amp;#8209;Wakefield.
        
    </div>
  
    Created using
    <a href="https://www.sphinx-doc.org/" target="_blank" rel="noopener">Sphinx</a>
    8.1.3.
     and
    <a href="https://github.com/jbms/sphinx-immaterial/" target="_blank" rel="noopener">Sphinx-Immaterial</a>
  
</div>
      
    </div>
    
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.top", "search.share", "toc.follow", "toc.sticky", "content.tabs.link", "announce.dismiss"], "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"provider": "mike", "staticVersions": null, "versionPath": null}}</script>
    
      
        <script src="../../_static/sphinx_immaterial_theme.f9d9eeeb247ace16c.min.js?v=8ec58cb5"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    
  </body>
</html>